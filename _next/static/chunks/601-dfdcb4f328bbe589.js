"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[601],{601:function(e,t,i){i.d(t,{Z:function(){return PlayerApp}});var s=i(5893),a=i(7294),r=i(1993);function getMixBySlug(e){return n.find(t=>t.slug===e)}let n=[{title:"Okay",slug:"okay",cover:"https://media.parttimechiller.com/Okay_PTC.png",audio:"https://media.parttimechiller.com/Okay_PTC.mp3",duration:"3:43",description:"I heard ya, okay?",type:"track",artist:"Part-Time Chiller"},{title:"Dive into dark",slug:"dive-into-dark",cover:"https://media.parttimechiller.com/DiveIntoDark_PTC.png",audio:"https://media.parttimechiller.com/DiveIntoDark_PTC.mp3",duration:"2:52",description:"Sometimes you need to go deep into the dark",type:"track",artist:"Part-Time Chiller"},{title:"Slow down",slug:"slow-down",cover:"https://media.parttimechiller.com/Slowdown_PTC.png",audio:"https://media.parttimechiller.com/Slowdown_PTC.mp3",duration:"2:36",description:"You just got too...",type:"track",artist:"Part-Time Chiller"},{title:"Slow Burn",slug:"slow-burn",cover:"https://media.parttimechiller.com/SlowBurn_PTC.png",audio:"https://media.parttimechiller.com/SlowBurn_PTC.mp3",duration:"3:47",description:"Low end head nodding vibes",type:"track",artist:"Part-Time Chiller"},{title:"Synthcopated",slug:"synthcopated",cover:"https://media.parttimechiller.com/Synthcopated_PTC.png",audio:"https://media.parttimechiller.com/Synthcopated_PTC.mp3",duration:"3:17",description:"A little bounce for an ounce.",type:"track",artist:"Part-Time Chiller"},{title:"Midnight interlude",slug:"midnight-interlude",cover:"https://media.parttimechiller.com/Midnight_Interlude_PTC.png",audio:"https://media.parttimechiller.com/Midnight_Interlude_PTC.mp3",duration:"5:30",description:"Driving down the freeway floating in darkness",type:"track",artist:"Part-Time Chiller"},{title:"Some Vibes",slug:"some-vibes",cover:"https://media.parttimechiller.com/SomeVibes_PTC.png",audio:"https://media.parttimechiller.com/SomeVibes_PTC.mp3",duration:"2:15",description:"Some Roland vibes for your midnight soul",type:"track",artist:"Part-Time Chiller"},{title:"Live at Oldfields mix",slug:"live-at-oldfields",cover:"https://media.parttimechiller.com/OldfieldsMix_PTC.png",audio:"https://media.parttimechiller.com/OldfieldsMix_PTC.mp3",duration:"3:00:00",description:"Midtempo vibes for Friday evening soir\xe9e",type:"mix",artist:"Part-Time Chiller DJ Set"},{title:"Live at Tamarak Ventures",slug:"live-at-tamarak-ventures",cover:"https://media.parttimechiller.com/TamarakMix_PTC.png",audio:"https://media.parttimechiller.com/TamarakMix_PTC.mp3",duration:"3:00:00",description:"Perfect early summertime evening vibes recorded at Tamarak Ventures 2025",type:"mix",artist:"Part-Time Chiller DJ Set"},{title:"Mixing at Margot",slug:"mixing-at-margot",cover:"https://media.parttimechiller.com/MixAtMargot_PTC.png",audio:"https://media.parttimechiller.com/MixAtMargot_PTC.mp3",duration:"2:38:29",description:"Sophisticated sexy vibes recorded live at Margot in Los Angeles",type:"mix",artist:"Part-Time Chiller DJ Set"},{title:"Rise Up",slug:"rise-up",cover:"https://media.parttimechiller.com/RiseUp_PTC.png",audio:"https://media.parttimechiller.com/RiseUp_PTC.mp3",duration:"3:28",description:"Time to get up and get down",type:"track",artist:"Part-Time Chiller"}],o=["bars","orb","web","terrain","chrysalis","sonicGalaxy","raindrops"],l={bars:"Bars",orb:"Orb",web:"Web",terrain:"Terrain",chrysalis:"Chrysalis",sonicGalaxy:"Sonic Galaxy",raindrops:"Raindrops"},h=["Stint Ultra Expanded","Barrio","Bungee Hairline","Splash","Cal Sans","Inconsolata","Kumbh Sans","Nabla","Barriecito"],c=(0,r.U)((e,t)=>({currentMix:null,isPlaying:!1,progress:0,currentTime:0,duration:0,volume:1,isMuted:!1,shuffleMode:!1,repeatMode:"off",filter:"all",showDetail:!0,showVisualizer:!0,showControls:!1,showPlaylist:!1,showDebug:!1,visualizerType:"terrain",currentFont:"Stint Ultra Expanded",dominantColor:"rgb(115, 115, 115)",accentColor:"rgb(163, 163, 163)",audioData:Array(64).fill(0),setCurrentMix:t=>e({currentMix:t}),setIsPlaying:t=>e({isPlaying:t}),setProgress:t=>e({progress:t}),setCurrentTime:t=>e({currentTime:t}),setDuration:t=>e({duration:t}),setVolume:t=>e({volume:Math.max(0,Math.min(1,t))}),toggleMute:()=>e(e=>({isMuted:!e.isMuted})),toggleShuffle:()=>e(e=>({shuffleMode:!e.shuffleMode})),cycleRepeat:()=>e(e=>({repeatMode:"off"===e.repeatMode?"all":"all"===e.repeatMode?"one":"off"})),setFilter:t=>e({filter:t}),setShowDetail:t=>e({showDetail:t}),setShowVisualizer:t=>e({showVisualizer:t}),setShowControls:t=>e({showControls:t}),setShowPlaylist:t=>e({showPlaylist:t}),setShowDebug:t=>e({showDebug:t}),setVisualizerType:t=>e({visualizerType:t}),setCurrentFont:t=>e({currentFont:t}),setDominantColor:t=>e({dominantColor:t}),setAccentColor:t=>e({accentColor:t}),setAudioData:t=>e({audioData:t}),getFilteredMixes:()=>{let{filter:e}=t();return n.filter(t=>"all"===e||t.type===e)},getCurrentIndex:()=>{let{currentMix:e}=t(),i=t().getFilteredMixes();return e?i.findIndex(t=>t.title===e.title):-1},playNext:()=>{let e=t(),i=e.getFilteredMixes(),s=e.getCurrentIndex();if("one"===e.repeatMode)return e.currentMix;if(e.shuffleMode){let e=i.filter((e,t)=>t!==s);return 0===e.length?null:e[Math.floor(Math.random()*e.length)]}return s<i.length-1?i[s+1]:"all"===e.repeatMode&&i.length>0?i[0]:null},playPrevious:()=>{let e=t(),i=e.getFilteredMixes(),s=e.getCurrentIndex();return e.currentTime>3?{action:"restart"}:s>0?{action:"previous",mix:i[s-1]}:"all"===e.repeatMode&&i.length>0?{action:"previous",mix:i[i.length-1]}:null}}));let AudioEngine=class AudioEngine{getAnalysis(e){return this.analyser.getByteFrequencyData(this.frequencyData),{frequencyData:this.frequencyData,audioData:this.mapFrequenciesToBars(),bassAvg:this.getFrequencyBandAverage(20,250),midAvg:this.getFrequencyBandAverage(250,2e3),highAvg:this.getFrequencyBandAverage(2e3,16e3),averageFrequency:this.getAverageFrequency(),normalizedFrequency:this.getAverageFrequency()/255,isPlaying:e}}mapFrequenciesToBars(){let e=[],t=this.audioContext.sampleRate,i=t/2,s=this.analyser.frequencyBinCount,a=Math.floor(.4*this.barCount),r=this.barCount-a;for(let t=0;t<a;t++){let r=t/(a-1),n=Math.sqrt(r),o=20*Math.pow(40,n),l=Math.floor(o/i*s);e.push(this.frequencyData[Math.min(l,s-1)])}for(let t=0;t<r;t++){let a=t/(r-1),n=800*Math.pow(20,a),o=Math.floor(n/i*s);e.push(this.frequencyData[Math.min(o,s-1)])}return e}getFrequencyBandAverage(e,t){let i=this.audioContext.sampleRate,s=i/2,a=this.analyser.frequencyBinCount,r=Math.floor(e/s*a),n=Math.floor(t/s*a),o=0,l=0;for(let e=r;e<=n&&e<a;e++)o+=this.frequencyData[e],l++;return l>0?o/l/255:0}getAverageFrequency(){let e=0;for(let t=0;t<this.frequencyData.length;t++)e+=this.frequencyData[t];return e/this.frequencyData.length}setBarCount(e){this.barCount=e}constructor(e,t,i=64){this.barCount=64,this.audioContext=e,this.analyser=t,this.barCount=i,this.frequencyData=new Uint8Array(t.frequencyBinCount)}};let BaseVisualizer=class BaseVisualizer{start(){if(this.isInitialized){console.warn("Visualizer already initialized");return}this.init(),this.isInitialized=!0,this.startInternalAnimationLoop()}startInternalAnimationLoop(){let animate=()=>{this.animationFrameId=requestAnimationFrame(animate),this.currentAudioAnalysis&&this.update(this.currentAudioAnalysis),this.render()};animate()}setAudioData(e){this.currentAudioAnalysis=e}updateConfig(e,t){this.config[e]=t}updateColors(e){this.colors=e}startAnimationLoop(e){let animate=()=>{this.animationFrameId=requestAnimationFrame(animate),e()};animate()}stopAnimationLoop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}parseRGB(e){let t=e.match(/\d+/g);return t&&t.length>=3?{r:parseInt(t[0])/255,g:parseInt(t[1])/255,b:parseInt(t[2])/255}:{r:1,g:.5,b:0}}constructor(e,t,i){this.animationFrameId=null,this.isInitialized=!1,this.currentAudioAnalysis=null,this.container=e,this.config=t,this.colors=i}};let BarsVisualizer=class BarsVisualizer extends BaseVisualizer{getName(){return"Bars"}getControls(){var e,t,i,s,a;return[{name:"Mode",key:"mode",min:0,max:3,step:1,default:0,value:null!==(e=this.config.mode)&&void 0!==e?e:0},{name:"Palette",key:"palette",min:0,max:6,step:1,default:0,value:null!==(t=this.config.palette)&&void 0!==t?t:0},{name:"Bar Height",key:"scale",min:.5,max:1.5,step:.1,default:.5,value:null!==(i=this.config.scale)&&void 0!==i?i:.5},{name:"Smoothness",key:"smoothness",min:.1,max:2,step:.1,default:1,value:null!==(s=this.config.smoothness)&&void 0!==s?s:1},{name:"Bar Width",key:"width",min:2,max:60,step:1,default:4,value:null!==(a=this.config.width)&&void 0!==a?a:4}]}init(){this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.resizeObserver.observe(this.container)}resizeCanvas(){if(!this.canvas)return;let e=window.devicePixelRatio||1,t=this.container.clientWidth,i=this.container.clientHeight;this.canvas.width=t*e,this.canvas.height=i*e}update(e){var t;if(!this.isInitialized)return;let{audioData:i,isPlaying:s}=e,a=null!==(t=this.config.smoothness)&&void 0!==t?t:1,r=1/(10*a);this.smoothedData.length!==i.length&&(this.smoothedData=Array(i.length).fill(0));for(let e=0;e<i.length;e++){let t=s?i[e]:0;this.smoothedData[e]+=(t-this.smoothedData[e])*r}}render(){var e;if(!this.ctx||!this.canvas)return;let t=window.devicePixelRatio||1,i=this.canvas.width/t,s=this.canvas.height/t;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(t,t);let a=Math.round(null!==(e=this.config.mode)&&void 0!==e?e:0);switch(a){case 1:this.renderCircle(i,s);break;case 2:this.renderSineWave(i,s);break;case 3:this.renderDots(i,s);break;default:this.renderLine(i,s)}this.ctx.restore()}renderLine(e,t){var i,s;let a=this.ctx,r=this.smoothedData.length,n=null!==(i=this.config.scale)&&void 0!==i?i:.5,o=null!==(s=this.config.width)&&void 0!==s?s:4,l=.6*t,h=.85*t,c=r*(o+2)-2,u=(e-c)/2;for(let e=0;e<r;e++){let t=this.smoothedData[e]/255,i=Math.max(2,t*l*n),s=u+e*(o+2),c=h-i;a.fillStyle=this.getBarColor(e,r);let d=Math.min(o/2,3);a.beginPath(),this.roundedRect(a,s,c,o,i,d),a.fill()}}renderCircle(e,t){var i,s;let a=this.ctx,r=this.smoothedData.length,n=null!==(i=this.config.scale)&&void 0!==i?i:.5,o=null!==(s=this.config.width)&&void 0!==s?s:4,l=e/2,h=t/2,c=.12*Math.min(e,t),u=.25*Math.min(e,t);for(let e=0;e<r;e++){let t=this.smoothedData[e]/255,i=e/r*Math.PI*2-Math.PI/2,s=Math.max(2,t*u*n),d=l+Math.cos(i)*c,m=h+Math.sin(i)*c,p=l+Math.cos(i)*(c+s),g=h+Math.sin(i)*(c+s);a.strokeStyle=this.getBarColor(e,r),a.lineWidth=Math.max(1,.6*o),a.lineCap="round",a.beginPath(),a.moveTo(d,m),a.lineTo(p,g),a.stroke()}}renderSineWave(e,t){var i,s;let a=this.ctx,r=this.smoothedData.length,n=null!==(i=this.config.scale)&&void 0!==i?i:.5,o=null!==(s=this.config.width)&&void 0!==s?s:4,l=.45*t,h=.65*t,c=.08*t,u=r*(o+2)-2,d=(e-u)/2,m=.001*Date.now();for(let e=0;e<r;e++){let t=this.smoothedData[e]/255,i=Math.max(2,t*l*n),s=d+e*(o+2),u=Math.sin(e/r*Math.PI*4+m)*c,p=h+u,g=p-i;a.fillStyle=this.getBarColor(e,r);let f=Math.min(o/2,3);a.beginPath(),this.roundedRect(a,s,g,o,i,f),a.fill()}}renderDots(e,t){var i,s;let a=this.ctx,r=this.smoothedData.length,n=null!==(i=this.config.scale)&&void 0!==i?i:.5,o=null!==(s=this.config.width)&&void 0!==s?s:4,l=Math.max(1,o/2),h=2.5*l,c=.85*t,u=r*(o+2)-2,d=(e-u)/2;for(let e=0;e<r;e++){let t=this.smoothedData[e]/255,i=Math.round(20*t*n),s=d+e*(o+2)+o/2,u=this.getBarColor(e,r);for(let e=0;e<i;e++){let t=c-e*h-l,i=1-e/20*.4;a.globalAlpha=i,a.fillStyle=u,a.beginPath(),a.arc(s,t,l,0,2*Math.PI),a.fill()}a.globalAlpha=1}}getBarColor(e,t){var i;let s=Math.round(null!==(i=this.config.palette)&&void 0!==i?i:0),a=t>1?e/(t-1):0;switch(s){case 0:{let e=this.parseRGB(this.colors.dominant),t=this.parseRGB(this.colors.accent),i=Math.round((e.r*(1-a)+t.r*a)*255),s=Math.round((e.g*(1-a)+t.g*a)*255),r=Math.round((e.b*(1-a)+t.b*a)*255);return"rgb(".concat(i,",").concat(s,",").concat(r,")")}case 1:default:return"hsl(".concat(360*a,", 80%, 55%)");case 2:return"hsl(".concat(55*a,", 90%, ").concat(45+15*a,"%)");case 3:return"hsl(".concat(220-50*a,", 75%, ").concat(40+20*a,"%)");case 4:return"hsl(".concat(300-180*a,", 100%, 55%)");case 5:{let e=a<.5?280+80*a:30+(a-.5)*30;return"hsl(".concat(e,", 80%, 50%)")}case 6:return"rgba(255, 255, 255, ".concat(.4+.6*a,")")}}roundedRect(e,t,i,s,a,r){r=Math.min(r,s/2,a/2),e.moveTo(t+r,i),e.arcTo(t+s,i,t+s,i+a,r),e.lineTo(t+s,i+a),e.lineTo(t,i+a),e.arcTo(t,i,t+r,i,r),e.closePath()}updateConfig(e,t){super.updateConfig(e,t)}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.canvas&&this.container.contains(this.canvas)&&this.container.removeChild(this.canvas),this.canvas=null,this.ctx=null,this.smoothedData=[]}constructor(e,t,i){super(e,t,i),this.canvas=null,this.ctx=null,this.resizeObserver=null,this.smoothedData=Array(64).fill(0)}};var u=i(4250),d=i(9477);let OrbVisualizer=class OrbVisualizer extends BaseVisualizer{getName(){return"Orb"}getControls(){var e,t,i,s,a,r,n,o;return[{name:"Shape",key:"shape",min:0,max:1,step:1,default:0,value:null!==(e=this.config.shape)&&void 0!==e?e:0},{name:"Light Intensity",key:"lightIntensity",min:.5,max:5,step:.1,default:2,value:null!==(t=this.config.lightIntensity)&&void 0!==t?t:2},{name:"Light Speed",key:"lightSpeed",min:0,max:2,step:.05,default:.5,value:null!==(i=this.config.lightSpeed)&&void 0!==i?i:.5},{name:"Ambient",key:"ambient",min:0,max:1,step:.05,default:.3,value:null!==(s=this.config.ambient)&&void 0!==s?s:.3},{name:"Audio Intensity",key:"freqMultiplier",min:1,max:10,step:.1,default:3.6,value:this.config.freqMultiplier||3.6},{name:"Surface Detail",key:"noiseMultiplier",min:.1,max:2,step:.05,default:.55,value:this.config.noiseMultiplier||.55},{name:"Animation Speed",key:"timeSpeed",min:.5,max:5,step:.1,default:2,value:this.config.timeSpeed||2},{name:"Rotation Speed",key:"autoRotationSpeed",min:0,max:.01,step:5e-4,default:.003,value:null!==(a=this.config.autoRotationSpeed)&&void 0!==a?a:.003},{name:"Radius",key:"radius",min:1,max:4,step:.1,default:2,value:null!==(r=this.config.radius)&&void 0!==r?r:2},{name:"Mesh Detail",key:"meshDetail",min:1,max:8,step:1,default:4,value:null!==(n=this.config.meshDetail)&&void 0!==n?n:4},{name:"Wireframe",key:"wireframe",min:0,max:1,step:1,default:1,value:null!==(o=this.config.wireframe)&&void 0!==o?o:1}]}init(){let e=this.container.clientWidth||800,t=this.container.clientHeight||600;this.scene=new u.xsS,this.camera=new u.cPb(75,e/t,.1,1e3),this.renderer=new d.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(e,t),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement),this.container.style.cursor="grab",this.container.style.touchAction="none",window.addEventListener("resize",()=>{if(!this.camera||!this.renderer)return;let e=this.container.clientWidth||800,t=this.container.clientHeight||600;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}),this.buildMesh(),this.camera.position.set(0,0,6),this.camera.lookAt(0,0,0),this.setupMouseControls(this.container)}buildMesh(){var e,t,i,s,a,r;let n;if(!this.scene)return;this.mesh&&(this.scene.remove(this.mesh),this.mesh.material instanceof u.F5T&&this.mesh.material.dispose()),this.geometry&&this.geometry.dispose(),this.lights.forEach(e=>{this.scene.remove(e),e.dispose()}),this.lights=[],this.orbitLights=[];let o=null!==(e=this.config.radius)&&void 0!==e?e:2,l=Math.min(Math.round(null!==(t=this.config.meshDetail)&&void 0!==t?t:4),8),h=null!==(i=this.config.shape)&&void 0!==i?i:0,c=(null!==(s=this.config.wireframe)&&void 0!==s?s:1)>0;if(1===h){let e=3*l+4;this.geometry=new u.xo$(o,e,e);let t=null!==(a=this.config.lightIntensity)&&void 0!==a?a:2,i=null!==(r=this.config.ambient)&&void 0!==r?r:.3;n=new u.xoR({color:13421772,flatShading:!0,shininess:150,specular:new u.Ilk(16777215),wireframe:c,transparent:!0,opacity:.95});for(let e=0;e<3;e++){let e=new u.cek(16777215,t,0);e.position.set(8,0,0),this.scene.add(e),this.lights.push(e),this.orbitLights.push(e)}let s=new u.cek(16777215,.5*t,0);s.position.set(0,0,-8),this.scene.add(s),this.lights.push(s);let h=Math.round(255*i),d=new u.Mig(new u.Ilk(h/255,h/255,h/255));this.scene.add(d),this.lights.push(d)}else this.geometry=new u.cJO(o,l),n=new u.vBJ({vertexColors:!0,wireframe:c,transparent:!0,opacity:.8});this.originalPositions=new Float32Array(this.geometry.attributes.position.array);let d=new Float32Array(3*this.geometry.attributes.position.count),m=this.parseRGB(this.colors.dominant);if(1===h)for(let e=0;e<d.length;e+=3)d[e]=.7+.3*m.r,d[e+1]=.7+.3*m.g,d[e+2]=.7+.3*m.b;else for(let e=0;e<d.length;e+=3)d[e]=m.r,d[e+1]=m.g,d[e+2]=m.b;this.geometry.setAttribute("color",new u.TlE(d,3)),this.mesh=new u.Kj0(this.geometry,n),this.scene.add(this.mesh)}setupMouseControls(e){let onMouseDown=e=>{this.isDragging=!0;let t="touches"in e?e.touches[0]:e;this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseMove=e=>{if(!this.isDragging)return;let t="touches"in e?e.touches[0]:e,i=t.clientX-this.lastMousePos.x,s=t.clientY-this.lastMousePos.y;this.cameraRotation.y+=.005*i,this.cameraRotation.x+=.005*s,this.cameraRotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.cameraRotation.x)),this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseUp=()=>{this.isDragging=!1};e.addEventListener("mousedown",onMouseDown),e.addEventListener("mousemove",onMouseMove),e.addEventListener("mouseup",onMouseUp),e.addEventListener("mouseleave",onMouseUp),e.addEventListener("touchstart",onMouseDown),e.addEventListener("touchmove",onMouseMove),e.addEventListener("touchend",onMouseUp)}update(e){var t,i,s;if(!this.isInitialized||!this.geometry||!this.originalPositions||!this.mesh||!this.camera)return;let{normalizedFrequency:a}=e,r=this.config.freqMultiplier||3.6,n=this.config.noiseMultiplier||.55,o=this.config.timeSpeed||2,l=null!==(t=this.config.autoRotationSpeed)&&void 0!==t?t:.003;if(this.isDragging||(this.cameraRotation.y+=l),this.camera.position.x=6*Math.sin(this.cameraRotation.y)*Math.cos(this.cameraRotation.x),this.camera.position.y=6*Math.sin(this.cameraRotation.x),this.camera.position.z=6*Math.cos(this.cameraRotation.y)*Math.cos(this.cameraRotation.x),this.camera.lookAt(0,0,0),(null!==(i=this.config.shape)&&void 0!==i?i:0)===1){let e=null!==(s=this.config.lightSpeed)&&void 0!==s?s:.5;this.lightTime+=.02*e,this.orbitLights.forEach((e,t)=>{let i=(1+.7*t)*this.lightTime,s=t*Math.PI/3;e.position.x=8*Math.cos(i)*Math.cos(s),e.position.y=8*Math.sin(.7*i+t),e.position.z=8*Math.sin(i)*Math.cos(s)}),this.mesh&&(this.mesh.rotation.y+=2*l,this.mesh.rotation.x+=.3*l)}let h=this.geometry.attributes.position,c=this.geometry.attributes.color,u=h.count,d=.001*Date.now()*o,m=this.parseRGB(this.colors.dominant),p=this.parseRGB(this.colors.accent);for(let e=0;e<u;e++){let t=this.originalPositions[3*e],i=this.originalPositions[3*e+1],s=this.originalPositions[3*e+2],o=t+d,l=i+d,u=s+d,g=Math.sin(2*o)*Math.cos(2*l)*.5+Math.sin(3*l)*Math.cos(3*u)*.3+Math.sin(4*u)*Math.cos(2*o)*.4+.3*Math.sin((o+l+u)*1.5),f=g*r*2,v=a*n*(.1*f),y=1+v;h.setXYZ(e,t*y,i*y,s*y);let x=8*Math.abs(v),w=Math.min(1,Math.max(0,x)),M=.15*Math.sin(.5*d+.01*e),b=Math.min(1,Math.max(0,w+M)),C=m.r+(p.r-m.r)*b,k=m.g+(p.g-m.g)*b,z=m.b+(p.b-m.b)*b;c.setXYZ(e,C,k,z)}h.needsUpdate=!0,c.needsUpdate=!0,this.geometry.computeVertexNormals()}render(){this.isInitialized&&this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateColors(e){super.updateColors(e)}updateConfig(e,t){super.updateConfig(e,t),"wireframe"===e&&this.mesh&&(this.mesh.material.wireframe=t>0),"lightIntensity"===e&&this.orbitLights.forEach(e=>{e.intensity=t}),"ambient"===e&&this.lights.forEach(e=>{e instanceof u.Mig&&e.color.setRGB(t,t,t)}),("radius"===e||"meshDetail"===e||"shape"===e)&&this.scene&&this.buildMesh()}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,this.renderer&&this.renderer.dispose(),this.geometry&&this.geometry.dispose(),this.mesh&&this.mesh.material&&this.mesh.material.dispose(),this.lights.forEach(e=>e.dispose()),this.lights=[],this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.originalPositions=null,this.container.innerHTML=""}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.originalPositions=null,this.cameraRotation={x:0,y:0},this.isDragging=!1,this.lastMousePos={x:0,y:0},this.lights=[],this.orbitLights=[],this.lightTime=0}};let WebVisualizer=class WebVisualizer extends BaseVisualizer{getName(){return"Web"}getControls(){var e;return[{name:"Bass Pulse",key:"bassPulse",min:0,max:1,step:.05,default:.4,value:this.config.bassPulse||.4},{name:"Mid Extension",key:"midExtension",min:0,max:1,step:.05,default:.5,value:this.config.midExtension||.5},{name:"High Shimmer",key:"highShimmer",min:0,max:.5,step:.05,default:.1,value:this.config.highShimmer||.1},{name:"Rotation Speed",key:"rotationSpeed",min:0,max:.01,step:5e-4,default:.002,value:this.config.rotationSpeed||.002},{name:"Radius",key:"radius",min:1,max:6,step:.1,default:3,value:null!==(e=this.config.radius)&&void 0!==e?e:3}]}init(){let e=this.container.clientWidth||800,t=this.container.clientHeight||600;this.scene=new u.xsS,this.camera=new u.cPb(75,e/t,.1,1e3),this.renderer=new d.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(e,t),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",()=>{if(!this.camera||!this.renderer)return;let e=this.container.clientWidth||800,t=this.container.clientHeight||600;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}),this.camera.position.set(0,5,5),this.camera.lookAt(0,0,0),this.group=new u.ZAu,this.scene.add(this.group);let i=[],s=[],a=this.parseRGB(this.colors.dominant);for(let e=0;e<12;e++){var r;let t=e/12*(null!==(r=this.config.radius)&&void 0!==r?r:3);for(let e=0;e<=64;e++){let r=e/64*Math.PI*2,n=Math.cos(r)*t,o=Math.sin(r)*t;i.push(n,o,0),s.push(a.r,a.g,a.b)}}let n=[];for(let e=0;e<64;e++)for(let t=0;t<11;t++){let i=65*t+e,s=(t+1)*65+e;n.push(i,s)}for(let e=0;e<12;e++)for(let t=0;t<64;t++){let i=65*e+t,s=65*e+t+1;n.push(i,s)}this.geometry=new u.u9r,this.geometry.setAttribute("position",new u.a$l(i,3)),this.geometry.setAttribute("color",new u.a$l(s,3)),this.geometry.setIndex(n);let o=new u.nls({vertexColors:!0,transparent:!0,opacity:.7});this.mesh=new u.ejS(this.geometry,o),this.group.add(this.mesh)}update(e){var t;if(!this.isInitialized||!this.geometry||!this.group)return;let{bassAvg:i,midAvg:s,highAvg:a}=e,r=this.config.bassPulse||.4,n=this.config.midExtension||.5,o=this.config.highShimmer||.1,l=this.config.rotationSpeed||.002,h=null!==(t=this.config.radius)&&void 0!==t?t:3,c=this.geometry.attributes.position,u=this.geometry.attributes.color,d=.001*Date.now(),m=this.parseRGB(this.colors.dominant),p=this.parseRGB(this.colors.accent),g=0;for(let e=0;e<12;e++){let t=e/11,l=e/12*h,f=(1-t)*i*r,v=(1-2*Math.abs(t-.5))*s*n;for(let s=0;s<=64;s++){let r=s/64*Math.PI*2,n=Math.sin(.5*s+3*d)*a*o,h=l+f+v+n,y=Math.cos(r)*h,x=Math.sin(r)*h,w=.3*Math.sin(.5*e+d+2*i);c.setXYZ(g,y,x,w);let M=i*(1-t),b=a*t,C=m.r*(.5+M)+p.r*b,k=m.g*(.5+M)+p.g*b,z=m.b*(.5+M)+p.b*b;u.setXYZ(g,C,k,z),g++}}c.needsUpdate=!0,u.needsUpdate=!0,this.group.rotation.z+=l}render(){this.isInitialized&&this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateColors(e){super.updateColors(e)}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,this.renderer&&this.renderer.dispose(),this.geometry&&this.geometry.dispose(),this.mesh&&this.mesh.material&&this.mesh.material.dispose(),this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.group=null,this.container.innerHTML=""}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.group=null}};let TerrainVisualizer=class TerrainVisualizer extends BaseVisualizer{getName(){return"Terrain"}getControls(){var e,t,i;return[{name:"Wave Amplitude",key:"amplitude",min:.5,max:5,step:.1,default:2,value:this.config.amplitude||2},{name:"Wave Speed",key:"speed",min:.5,max:20,step:.5,default:17.5,value:this.config.speed||17.5},{name:"Wave Decay",key:"decay",min:.85,max:.99,step:.01,default:.95,value:this.config.decay||.95},{name:"Camera Distance",key:"cameraDistance",min:5,max:15,step:.5,default:8,value:this.config.cameraDistance||8},{name:"Auto Rotation",key:"autoRotation",min:0,max:.01,step:5e-4,default:.002,value:null!==(e=this.config.autoRotation)&&void 0!==e?e:.002},{name:"Segments",key:"segments",min:32,max:256,step:32,default:64,value:null!==(t=this.config.segments)&&void 0!==t?t:64},{name:"Sine Base",key:"sineAmplitude",min:0,max:1.5,step:.05,default:.3,value:null!==(i=this.config.sineAmplitude)&&void 0!==i?i:.3}]}init(){var e;let t=this.container.clientWidth||800,i=this.container.clientHeight||600;this.scene=new u.xsS,this.camera=new u.cPb(75,t/i,.1,1e3),this.renderer=new d.CP7({antialias:!1,alpha:!0,powerPreference:"high-performance"}),this.renderer.setSize(t,i),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement),this.container.style.cursor="grab",this.container.style.touchAction="none",this.updateCameraPosition(),this.segmentsX=null!==(e=this.config.segments)&&void 0!==e?e:64,this.geometry=new u._12(10,20,this.segmentsX-1,this.segmentsZ-1),this.geometry.rotateX(-Math.PI/2);for(let e=0;e<this.segmentsZ;e++)this.waveHistory.push(Array(this.segmentsX).fill(0));let s=this.geometry.attributes.position,a=new Float32Array(3*s.count),r=this.parseRGB(this.colors.dominant);for(let e=0;e<s.count;e++)a[3*e]=r.r,a[3*e+1]=r.g,a[3*e+2]=r.b;this.geometry.setAttribute("color",new u.TlE(a,3));let n=new u.Mig(16777215,.4);this.scene.add(n);let o=new u.Ox3(16777215,.8);o.position.set(5,10,5),this.scene.add(o);let l=new u.Ox3(4482815,.4);l.position.set(-5,5,-5),this.scene.add(l);let h=new u.xoR({vertexColors:!0,wireframe:!0,transparent:!0,opacity:.8,shininess:30,flatShading:!1});this.mesh=new u.Kj0(this.geometry,h),this.mesh.position.z=-10,this.scene.add(this.mesh),this.lastUpdateTime=Date.now(),this.setupCameraControls(this.container)}setupCameraControls(e){e.style.cursor="grab";let onMouseDown=e=>{this.isDragging=!0;let t="touches"in e?e.touches[0]:e;this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseMove=e=>{if(!this.isDragging)return;let t="touches"in e?e.touches[0]:e,i=t.clientX-this.lastMousePos.x,s=t.clientY-this.lastMousePos.y;this.cameraRotation.y+=.005*i,this.cameraRotation.x+=.005*s,this.cameraRotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.cameraRotation.x)),this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseUp=()=>{this.isDragging=!1};e.addEventListener("mousedown",onMouseDown),e.addEventListener("mousemove",onMouseMove),e.addEventListener("mouseup",onMouseUp),e.addEventListener("mouseleave",onMouseUp),e.addEventListener("touchstart",onMouseDown),e.addEventListener("touchmove",onMouseMove),e.addEventListener("touchend",onMouseUp)}updateCameraPosition(){var e;if(!this.camera)return;let t=this.config.cameraDistance||8,i=null!==(e=this.config.autoRotation)&&void 0!==e?e:.002;this.isDragging||(this.cameraRotation.y+=i),this.camera.position.x=t*Math.sin(this.cameraRotation.y)*Math.cos(this.cameraRotation.x),this.camera.position.y=t*Math.sin(this.cameraRotation.x),this.camera.position.z=t*Math.cos(this.cameraRotation.y)*Math.cos(this.cameraRotation.x),this.camera.lookAt(0,0,-5)}smoothWave(e,t){let i=e;for(let e=0;e<t;e++){let e=Array(i.length);for(let t=0;t<i.length;t++){let s=i[Math.max(0,t-1)],a=i[t],r=i[Math.min(i.length-1,t+1)];e[t]=.25*s+.5*a+.25*r}i=e}return i}resampleData(e,t){let i=Array(t),s=e.length/t;for(let a=0;a<t;a++){let t=a*s,r=Math.floor(t),n=Math.min(r+1,e.length-1),o=t-r;i[a]=e[r]*(1-o)+e[n]*o}return i}rebuildGeometry(){if(!this.scene||!this.mesh)return;this.geometry&&this.geometry.dispose(),this.geometry=new u._12(10,20,this.segmentsX-1,this.segmentsZ-1),this.geometry.rotateX(-Math.PI/2),this.waveHistory=[];for(let e=0;e<this.segmentsZ;e++)this.waveHistory.push(Array(this.segmentsX).fill(0));let e=this.geometry.attributes.position,t=new Float32Array(3*e.count),i=this.parseRGB(this.colors.dominant);for(let s=0;s<e.count;s++)t[3*s]=i.r,t[3*s+1]=i.g,t[3*s+2]=i.b;this.geometry.setAttribute("color",new u.TlE(t,3)),this.mesh.geometry=this.geometry}update(e){var t,i;if(!this.isInitialized||!this.geometry||!this.camera)return;let{audioData:s}=e,a=this.config.amplitude||2,r=this.config.speed||1,n=this.config.decay||.95,o=Date.now();if(this.updateCameraPosition(),o-this.lastUpdateTime>=1e3/r){this.waveHistory.pop();let e=this.resampleData(s,this.segmentsX),t=e.map(e=>e/255*a),i=this.smoothWave(t,3);this.waveHistory.unshift(i),this.lastUpdateTime=o}if(this.frameCount++,this.frameCount%2!=0)return;let l=this.geometry.attributes.position,h=this.geometry.attributes.color,c=this.parseRGB(this.colors.dominant),u=this.parseRGB(this.colors.accent),d=[];for(let e=0;e<this.segmentsZ;e++)d[e]=Math.pow(n,e);let m=null!==(t=this.config.sineAmplitude)&&void 0!==t?t:.3,p=.001*Date.now();for(let e=0;e<this.segmentsZ;e++){let t=d[e],s=e/(this.segmentsZ-1)*2-1;for(let r=0;r<this.segmentsX;r++){let n=e*this.segmentsX+r,o=r/(this.segmentsX-1)*2-1,d=((null===(i=this.waveHistory[e])||void 0===i?void 0:i[r])||0)*t,g=m*(.6*Math.sin(o*Math.PI*2+.5*p)+.4*Math.cos(s*Math.PI*1.5+.3*p));if(l.setY(n,d+g),e<.7*this.segmentsZ){let e=Math.min(1,Math.abs(d)/a),t=c.r+(u.r-c.r)*e,i=c.g+(u.g-c.g)*e,s=c.b+(u.b-c.b)*e;h.setXYZ(n,t,i,s)}}}l.needsUpdate=!0,h.needsUpdate=!0,this.geometry.computeVertexNormals()}render(){this.isInitialized&&this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}updateColors(e){super.updateColors(e)}updateConfig(e,t){super.updateConfig(e,t),"segments"===e&&(this.segmentsX=t,this.rebuildGeometry())}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,this.renderer&&this.renderer.dispose(),this.geometry&&this.geometry.dispose(),this.mesh&&this.mesh.material&&this.mesh.material.dispose(),this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.waveHistory=[],this.container.innerHTML=""}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.geometry=null,this.mesh=null,this.waveHistory=[],this.lastUpdateTime=0,this.segmentsX=64,this.segmentsZ=40,this.cameraRotation={x:.7,y:0},this.isDragging=!1,this.lastMousePos={x:0,y:0},this.frameCount=0}};var m=i(4175),p=i(1911),g=i(9823);let ChrysalisVisualizer=class ChrysalisVisualizer extends BaseVisualizer{getName(){return"Chrysalis"}getControls(){var e;return[{name:"Contour Loops",key:"slices",min:16,max:64,step:8,default:56,value:this.config.slices||56},{name:"Noise Scale",key:"waviness",min:0,max:1,step:.05,default:.05,value:this.config.waviness||.05},{name:"Rotation Speed",key:"rotationSpeed",min:0,max:.01,step:5e-4,default:.003,value:this.config.rotationSpeed||.003},{name:"Pulse Intensity",key:"pulseIntensity",min:0,max:1.5,step:.1,default:.7,value:this.config.pulseIntensity||.7},{name:"Line Thickness",key:"lineThickness",min:.5,max:5,step:.5,default:2,value:this.config.lineThickness||2},{name:"Radius",key:"radius",min:1,max:8,step:.5,default:5,value:null!==(e=this.config.radius)&&void 0!==e?e:5}]}init(){this.scene=new u.xsS,this.camera=new u.cPb(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.renderer=new d.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",()=>{this.resize(this.container.clientWidth,this.container.clientHeight)}),this.camera.position.z=12,this.chrysalisGroup=new u.ZAu,this.scene.add(this.chrysalisGroup),this.setupMouseControls(),this.initializeLoops()}setupMouseControls(){this.container.style.cursor="grab",this.container.style.touchAction="none";let onMouseDown=e=>{this.isDragging=!0,this.container.style.cursor="grabbing";let t="touches"in e?e.touches[0]:e;this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseMove=e=>{if(!this.isDragging)return;let t="touches"in e?e.touches[0]:e,i=t.clientX-this.lastMousePos.x,s=t.clientY-this.lastMousePos.y;this.userRotation.y+=.005*i,this.userRotation.x+=.005*s,this.lastMousePos={x:t.clientX,y:t.clientY}},onMouseUp=()=>{this.isDragging=!1,this.container.style.cursor="grab"};this.container.addEventListener("mousedown",onMouseDown),this.container.addEventListener("mousemove",onMouseMove),this.container.addEventListener("mouseup",onMouseUp),this.container.addEventListener("mouseleave",onMouseUp),this.container.addEventListener("touchstart",onMouseDown),this.container.addEventListener("touchmove",onMouseMove),this.container.addEventListener("touchend",onMouseUp)}noise(e,t,i){let s=43758.5453123*Math.sin(12.9898*e+78.233*t+i);return s-Math.floor(s)}getColorFromHue(e){return new u.Ilk().setHSL(e/360,.8,.6)}createContourLoop(e,t,i,s,a,r,n){let o=[];for(let a=0;a<=s;a++){let l=a%s,h=l/s*Math.PI*2,c=i*Math.sin(h),u=i*Math.cos(h),d=this.noise(2*h,3*e,n),m=1+(d-.5)*r,p=u*m,g=(t+p)*Math.cos(e),f=(t+p)*Math.sin(e);o.push(g,c,f)}let l=new g.L;l.setPositions(o);let h=new p.Y({color:a.getHex(),transparent:!0,opacity:.7,linewidth:this.config.lineThickness||2,resolution:new u.FM8(this.container.clientWidth,this.container.clientHeight)});return new m.w(l,h)}initializeLoops(){var e;if(!this.chrysalisGroup)return;let t=this.config.slices||56,i=null!==(e=this.config.radius)&&void 0!==e?e:5,s=.8*i;this.loops.forEach(e=>{this.chrysalisGroup.remove(e.loop),e.loop.geometry.dispose(),e.loop.material.dispose()}),this.loops.length=0;for(let e=0;e<t;e++){let a=e/t*Math.PI*2,r=e/(t-1),n=s*Math.sin(r*Math.PI),o=e,l=e/t*360,h=this.getColorFromHue(l),c=this.createContourLoop(a,n,i,80,h,this.config.waviness||.05,100*e);this.chrysalisGroup.add(c),this.loops.push({loop:c,baseY:0,baseRadius:i,freqIndex:o,vertices:80,seed:100*e})}}update(e){var t,i;if(!this.isInitialized||!this.chrysalisGroup)return;let s=this.config.slices||56,a=null!==(t=this.config.radius)&&void 0!==t?t:5;(this.loops.length!==s||this.loops.length>0&&this.loops[0].baseRadius!==a)&&this.initializeLoops();let r=this.config.rotationSpeed||.003;!this.isDragging&&r>0&&(this.userRotation.y+=r),this.chrysalisGroup.rotation.x=this.userRotation.x,this.chrysalisGroup.rotation.y=this.userRotation.y;let n=this.config.waviness||.05,o=this.config.pulseIntensity||.7,l=null!==(i=this.config.radius)&&void 0!==i?i:5,h=.8*l,c=.001*Date.now();this.loops.forEach((t,i)=>{let s=Math.floor(t.freqIndex/this.loops.length*e.frequencyData.length),a=Math.min(s,e.frequencyData.length-1),r=(e.frequencyData[a]||0)/255,l=i/this.loops.length*Math.PI*2,u=i/(this.loops.length-1),d=h*Math.sin(u*Math.PI),m=t.baseRadius*(1+r*o),p=[];for(let e=0;e<=t.vertices;e++){let i=e%t.vertices,s=i/t.vertices*Math.PI*2,a=m*Math.sin(s),r=m*Math.cos(s),o=this.noise(2*s+.2*c,3*l,t.seed),h=1+(o-.5)*n,u=r*h,g=(d+u)*Math.cos(l),f=(d+u)*Math.sin(l);p.push(g,a,f)}t.loop.geometry.setPositions(p);let g=t.loop.material;g.opacity=.5+.4*r,g.linewidth=this.config.lineThickness||2})}render(){this.isInitialized&&this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}resize(e,t){this.camera&&this.renderer&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.loops.forEach(i=>{i.loop.material.resolution.set(e,t)}))}updateColors(e){this.colors=e}setCameraView(e){switch(e){case"x":this.userRotation.x=0,this.userRotation.y=Math.PI/2;break;case"y":this.userRotation.x=-Math.PI/2,this.userRotation.y=0;break;case"z":this.userRotation.x=0,this.userRotation.y=0}}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,null!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.loops.forEach(e=>{e.loop.geometry.dispose(),e.loop.material.dispose()}),this.renderer&&(this.renderer.dispose(),this.container.contains(this.renderer.domElement)&&this.container.removeChild(this.renderer.domElement)),this.scene=null,this.camera=null,this.renderer=null,this.chrysalisGroup=null,this.loops=[]}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.chrysalisGroup=null,this.loops=[],this.userRotation={x:-.8,y:.3},this.isDragging=!1,this.lastMousePos={x:0,y:0}}};let SonicGalaxyVisualizer=class SonicGalaxyVisualizer extends BaseVisualizer{getName(){return"Sonic Galaxy"}getControls(){var e,t,i;return[{name:"Particle Count",key:"particleCount",min:1e3,max:1e5,step:5e3,default:3e4,value:this.config.particleCount||3e4},{name:"Attractor Count",key:"attractorCount",min:2,max:6,step:1,default:4,value:this.config.attractorCount||4},{name:"Bass Gravity",key:"bassGravity",min:.5,max:10,step:.5,default:2,value:this.config.bassGravity||2},{name:"Mid Spin",key:"midSpin",min:.5,max:10,step:.5,default:2,value:this.config.midSpin||2},{name:"Max Speed",key:"maxSpeed",min:2,max:15,step:.5,default:8,value:this.config.maxSpeed||8},{name:"Velocity Damping",key:"velocityDamping",min:0,max:.2,step:.01,default:.04,value:null!==(e=this.config.velocityDamping)&&void 0!==e?e:.04},{name:"Particle Size",key:"particleSize",min:.5,max:5,step:.5,default:1,value:this.config.particleSize||1},{name:"Camera Speed",key:"cameraSpeed",min:0,max:.02,step:.001,default:.004,value:null!==(t=this.config.cameraSpeed)&&void 0!==t?t:.004},{name:"Trail",key:"trail",min:0,max:.95,step:.01,default:0,value:null!==(i=this.config.trail)&&void 0!==i?i:0},{name:"Beat Sensitivity",key:"beatSensitivity",min:.5,max:2,step:.1,default:1.2,value:this.config.beatSensitivity||1.2}]}init(){var e;this.scene=new u.xsS;let t=this.container.clientWidth||800,i=this.container.clientHeight||600;this.camera=new u.cPb(60,t/i,.1,1e3),this.renderer=new d.CP7({antialias:!0,alpha:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0}),this.renderer.setSize(t,i),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setClearColor(0,1),this.renderer.autoClear=!1,this.container.appendChild(this.renderer.domElement),this.fadeScene=new u.xsS,this.fadeCamera=new u.iKG(-1,1,1,-1,0,1);let s=new u._12(2,2),a=null!==(e=this.config.trail)&&void 0!==e?e:0;this.fadeMaterial=new u.vBJ({color:0,transparent:!0,depthWrite:!1,depthTest:!1,opacity:a>0?.08*(1-a):1});let r=new u.Kj0(s,this.fadeMaterial);this.fadeScene.add(r),a>0&&(this.renderer.domElement.style.filter="blur(".concat(2*a,"px)")),this.initializeAttractors(),this.initializeParticles(),this.updateCameraPosition(),window.addEventListener("resize",()=>{if(!this.camera||!this.renderer||!this.container)return;let e=this.container.clientWidth||800,t=this.container.clientHeight||600;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)})}initializeAttractors(){let e=this.config.attractorCount||4;this.attractors=[];for(let t=0;t<e;t++){let i=Math.acos(-1+2*t/e),s=Math.sqrt(e*Math.PI)*i,a=new u.Pa4(2.5*Math.cos(s)*Math.sin(i),2.5*Math.sin(s)*Math.sin(i),2.5*Math.cos(i)),r=new u.Pa4(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).normalize();this.attractors.push({position:a,mass:5e7,baseMass:5e7,rotationAxis:r,spinStrength:2})}}initializeParticles(){let e=this.config.particleCount||this.particleCount;this.particles=[];let t=[],i=[],s=[];for(let a=0;a<e;a++){let e=3*Math.random()+1,a=Math.random()*Math.PI*2,r=Math.acos(2*Math.random()-1),n=new u.Pa4(e*Math.sin(r)*Math.cos(a),e*Math.sin(r)*Math.sin(a),e*Math.cos(r)),o=new u.Pa4((Math.random()-.5)*.1,(Math.random()-.5)*.1,(Math.random()-.5)*.1),l=(.75*Math.random()+.25)*1e4;this.particles.push({position:n,velocity:o,mass:l});let h=360*Math.random(),c=60+40*Math.random(),d=50+30*Math.random(),m=new u.Ilk().setHSL(h/360,c/100,d/100);t.push(n.x,n.y,n.z),i.push(m.r,m.g,m.b),s.push(l/1e4*(this.config.particleSize||1))}let a=[];for(let t=0;t<e;t++)a.push(t%3);let r=new u.u9r;r.setAttribute("position",new u.a$l(t,3)),r.setAttribute("color",new u.a$l(i,3)),r.setAttribute("size",new u.a$l(s,1)),r.setAttribute("frequencyBand",new u.a$l(a,1));let n=new u.jyz({uniforms:{colorA:{value:new u.Ilk(this.colors.dominant)},colorB:{value:new u.Ilk(this.colors.accent)},bassIntensity:{value:0},midIntensity:{value:0},highIntensity:{value:0},beatBoost:{value:1}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        attribute float frequencyBand;\n        uniform float bassIntensity;\n        uniform float midIntensity;\n        uniform float highIntensity;\n        uniform float beatBoost;\n        varying vec3 vColor;\n        varying float vFrequencyBand;\n\n        void main() {\n          vColor = color;\n          vFrequencyBand = frequencyBand;\n\n          // Audio-reactive size modulation per frequency band\n          float audioBoost = 1.0;\n          if (frequencyBand < 0.5) {\n            audioBoost += bassIntensity * 3.0;\n          } else if (frequencyBand < 1.5) {\n            audioBoost += midIntensity * 2.0;\n          } else {\n            audioBoost += highIntensity * 1.5;\n          }\n          audioBoost *= beatBoost;\n\n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * audioBoost * (100.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        uniform float bassIntensity;\n        uniform float midIntensity;\n        uniform float highIntensity;\n        varying vec3 vColor;\n        varying float vFrequencyBand;\n\n        void main() {\n          float dist = length(gl_PointCoord - vec2(0.5));\n\n          // Gaussian falloff for smoky, nebula-like appearance\n          float gaussian = exp(-dist * dist * 6.0);\n\n          // Get intensity based on frequency band\n          float bandIntensity = 0.2;\n          if (vFrequencyBand < 0.5) {\n            bandIntensity += bassIntensity * 2.0;\n          } else if (vFrequencyBand < 1.5) {\n            bandIntensity += midIntensity * 2.0;\n          } else {\n            bandIntensity += highIntensity * 2.0;\n          }\n\n          bandIntensity = clamp(bandIntensity, 0.2, 3.0);\n\n          // Bass-driven global opacity pulse\n          float bassPulse = 0.2 + bassIntensity * 0.8;\n\n          float alpha = gaussian * bandIntensity * bassPulse;\n          gl_FragColor = vec4(vColor * bandIntensity, alpha);\n        }\n      ",transparent:!0,blending:u.WMw,depthWrite:!1});this.particleMesh=new u.woe(r,n),this.scene.add(this.particleMesh)}updatePhysics(e){var t;let i=e.bassAvg/255,s=e.midAvg/255,a=e.highAvg/255;this.smoothBass+=(i-this.smoothBass)*.3,this.smoothMid+=(s-this.smoothMid)*.3,this.smoothHigh+=(a-this.smoothHigh)*.3;let r=Math.max(i,this.smoothBass),n=Math.max(s,this.smoothMid),o=Math.max(a,this.smoothHigh),l=this.config.bassGravity||2,h=this.config.midSpin||2;this.beatBoost+=(1-this.beatBoost)*.06,this.attractors.forEach((e,t)=>{let i=t%3/3;e.mass=e.baseMass*(1+(i<.33?r:i<.66?n:o)*l*12)*this.beatBoost,e.spinStrength=2+n*h*10});let c=.5*r+.3*n+.2*o;if(c>this.beatThreshold*(this.config.beatSensitivity||1.2)){let e=Date.now();e-this.lastBeatTime>this.beatCooldown&&(this.onBeat(c),this.lastBeatTime=e)}this.beatThreshold=.93*this.beatThreshold+.07*c;let d=this.config.maxSpeed||8,m=1-(null!==(t=this.config.velocityDamping)&&void 0!==t?t:.04);this.particles.forEach(e=>{let t=new u.Pa4(0,0,0);this.attractors.forEach(i=>{let s=new u.Pa4().subVectors(i.position,e.position),a=s.length();if(a<.1)return;let r=s.normalize(),n=i.mass*e.mass*this.GRAVITY_CONSTANT/(a*a),o=r.multiplyScalar(n);t.add(o);let l=new u.Pa4().crossVectors(i.rotationAxis,s).multiplyScalar(n*i.spinStrength);t.add(l)});let i=e.position.length();if(i>8){let s=e.position.clone().normalize().multiplyScalar(-((i-8)*.15));t.add(s)}e.velocity.add(t.multiplyScalar(this.DELTA_TIME));let s=e.velocity.length();s>d&&e.velocity.normalize().multiplyScalar(d),e.velocity.multiplyScalar(m),e.position.add(new u.Pa4().copy(e.velocity).multiplyScalar(this.DELTA_TIME))})}onBeat(e){this.beatBoost=1+4*e,this.particles.forEach(t=>{let i=t.position.clone().normalize();t.velocity.add(i.multiplyScalar(2*e))})}updateCameraPosition(){if(!this.camera)return;let e=this.config.cameraDistance||this.cameraDistance;this.camera.position.x=Math.cos(this.cameraAngle)*e,this.camera.position.z=Math.sin(this.cameraAngle)*e,this.camera.position.y=this.cameraHeight,this.camera.lookAt(0,0,0)}update(e){var t;if(!this.isInitialized)return;e.isPlaying&&this.updatePhysics(e);let i=null!==(t=this.config.cameraSpeed)&&void 0!==t?t:.004;if(this.cameraAngle+=i,this.updateCameraPosition(),this.particleMesh){let t=this.particleMesh.geometry.attributes.position.array,i=this.particleMesh.geometry.attributes.size.array,s=this.config.particleSize||1;this.particleMesh.material instanceof u.jyz&&(this.particleMesh.material.uniforms.bassIntensity.value=Math.max(e.bassAvg/255,this.smoothBass),this.particleMesh.material.uniforms.midIntensity.value=Math.max(e.midAvg/255,this.smoothMid),this.particleMesh.material.uniforms.highIntensity.value=Math.max(e.highAvg/255,this.smoothHigh),this.particleMesh.material.uniforms.beatBoost.value=this.beatBoost),this.particles.forEach((e,a)=>{t[3*a]=e.position.x,t[3*a+1]=e.position.y,t[3*a+2]=e.position.z;let r=e.velocity.length();i[a]=e.mass/1e4*s*(1+.1*r)}),this.particleMesh.geometry.attributes.position.needsUpdate=!0,this.particleMesh.geometry.attributes.size.needsUpdate=!0}}render(){var e;if(!this.isInitialized||!this.renderer||!this.scene||!this.camera)return;let t=null!==(e=this.config.trail)&&void 0!==e?e:0;t>0&&this.fadeScene&&this.fadeCamera?(this.renderer.render(this.fadeScene,this.fadeCamera),this.renderer.clearDepth()):this.renderer.clear(),this.renderer.render(this.scene,this.camera)}destroy(){this.stopAnimationLoop(),this.isInitialized=!1,this.particleMesh&&(this.particleMesh.geometry.dispose(),this.particleMesh.material instanceof u.F5T&&this.particleMesh.material.dispose()),this.fadeMaterial&&this.fadeMaterial.dispose(),this.renderer&&(this.renderer.domElement.style.filter="none",this.renderer.dispose(),this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement)),this.scene=null,this.camera=null,this.renderer=null,this.particleMesh=null,this.fadeScene=null,this.fadeCamera=null,this.fadeMaterial=null,this.particles=[],this.attractors=[]}updateConfig(e,t){if(super.updateConfig(e,t),"particleCount"===e&&this.scene&&(this.particleMesh&&(this.scene.remove(this.particleMesh),this.particleMesh.geometry.dispose(),this.particleMesh.material instanceof u.F5T&&this.particleMesh.material.dispose()),this.particleCount=t,this.initializeParticles()),"attractorCount"===e&&this.scene&&this.initializeAttractors(),"cameraDistance"===e&&(this.cameraDistance=t,this.updateCameraPosition()),"particleSize"===e&&this.particleMesh){let e=this.particleMesh.geometry.attributes.size.array;this.particles.forEach((i,s)=>{e[s]=i.mass/1e4*t}),this.particleMesh.geometry.attributes.size.needsUpdate=!0}"trail"===e&&this.renderer&&(this.fadeMaterial&&(this.fadeMaterial.opacity=t>0?.08*(1-t):1),this.renderer.domElement.style.filter=t>0?"blur(".concat(2*t,"px)"):"none")}updateColors(e){super.updateColors(e),this.particleMesh&&this.particleMesh.material instanceof u.jyz&&(this.particleMesh.material.uniforms.colorA.value=new u.Ilk(e.dominant),this.particleMesh.material.uniforms.colorB.value=new u.Ilk(e.accent))}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.attractors=[],this.particles=[],this.particleMesh=null,this.particleCount=3e4,this.fadeScene=null,this.fadeCamera=null,this.fadeMaterial=null,this.GRAVITY_CONSTANT=667e-12,this.DELTA_TIME=1/60,this.cameraAngle=0,this.cameraHeight=3,this.cameraDistance=8,this.beatThreshold=0,this.lastBeatTime=0,this.beatCooldown=300,this.beatBoost=1,this.smoothBass=0,this.smoothMid=0,this.smoothHigh=0}};let RaindropsVisualizer=class RaindropsVisualizer extends BaseVisualizer{getName(){return"Raindrops"}getControls(){var e,t,i,s,a,r,n,o,l;return[{name:"Max Ripples",key:"maxRipples",min:32,max:256,step:16,default:64,value:null!==(e=this.config.maxRipples)&&void 0!==e?e:64},{name:"Bass Threshold",key:"bassThreshold",min:.1,max:.8,step:.05,default:.1,value:null!==(t=this.config.bassThreshold)&&void 0!==t?t:.1},{name:"Plane Size",key:"planeSize",min:10,max:40,step:2,default:40,value:null!==(i=this.config.planeSize)&&void 0!==i?i:40},{name:"Intensity",key:"intensity",min:.5,max:3,step:.1,default:.8,value:null!==(s=this.config.intensity)&&void 0!==s?s:.8},{name:"Ring Thickness",key:"ringThickness",min:.1,max:1,step:.05,default:.1,value:null!==(a=this.config.ringThickness)&&void 0!==a?a:.1},{name:"Layout Mode",key:"layoutMode",min:0,max:3,step:1,default:0,value:null!==(r=this.config.layoutMode)&&void 0!==r?r:0},{name:"Show Grid Overlay",key:"showGridOverlay",min:0,max:1,step:1,default:1,value:null!==(n=this.config.showGridOverlay)&&void 0!==n?n:1},{name:"Surface",key:"surfaceMode",min:0,max:2,step:1,default:0,value:null!==(o=this.config.surfaceMode)&&void 0!==o?o:0},{name:"Auto Rotation",key:"autoRotation",min:0,max:.01,step:5e-4,default:.003,value:null!==(l=this.config.autoRotation)&&void 0!==l?l:.003}]}initScene(){this.scene=new u.xsS,this.camera=new u.cPb(60,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.renderer=new d.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.container.appendChild(this.renderer.domElement),this.observeResize(),this.setupMouseDrag(),this.updateCameraPosition(),this.updateSurfaceMesh(),this.updateGridOverlay()}observeResize(){this.resizeObserver||(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container))}handleResize(){if(!this.renderer||!this.camera)return;let e=Math.max(1,this.container.clientWidth),t=Math.max(1,this.container.clientHeight);this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.updateGridOverlay()}setupMouseDrag(){this.boundOnMouseDown=e=>{var t;let i=null!==(t=this.config.surfaceMode)&&void 0!==t?t:0;0!==i&&(this.isDragging=!0,this.lastMouse={x:e.clientX,y:e.clientY})},this.boundOnMouseMove=e=>{if(!this.isDragging)return;let t=e.clientX-this.lastMouse.x,i=e.clientY-this.lastMouse.y;this.cameraRotation.y+=.005*t,this.cameraRotation.x+=.005*i,this.cameraRotation.x=Math.max(-Math.PI/2+.1,Math.min(Math.PI/2-.1,this.cameraRotation.x)),this.lastMouse={x:e.clientX,y:e.clientY}},this.boundOnMouseUp=()=>{this.isDragging=!1},this.container.addEventListener("mousedown",this.boundOnMouseDown),window.addEventListener("mousemove",this.boundOnMouseMove),window.addEventListener("mouseup",this.boundOnMouseUp)}updateCameraPosition(){var e;if(!this.camera)return;let t=null!==(e=this.config.surfaceMode)&&void 0!==e?e:0;0===t?this.camera.position.set(0,20,0):(this.camera.position.x=12*Math.sin(this.cameraRotation.y)*Math.cos(this.cameraRotation.x),this.camera.position.y=12*Math.sin(this.cameraRotation.x),this.camera.position.z=12*Math.cos(this.cameraRotation.y)*Math.cos(this.cameraRotation.x)),this.camera.lookAt(0,0,0)}updateSurfaceMesh(){var e;let t;if(!this.scene)return;this.surfaceMesh&&(this.scene.remove(this.surfaceMesh),this.surfaceMesh.geometry.dispose(),this.surfaceMesh.material.dispose(),this.surfaceMesh=null);let i=null!==(e=this.config.surfaceMode)&&void 0!==e?e:0;if(0===i)return;t=1===i?new u.DvJ(6,6,6):new u.xo$(4,24,16);let s=new u.TOt(t);t.dispose();let a=new u.nls({color:new u.Ilk(1,1,1),transparent:!0,opacity:.08});this.surfaceMesh=new u.ejS(s,a),this.scene.add(this.surfaceMesh)}getLayoutBounds(){if(!this.camera){let e=this.config.planeSize||20,t=.9*e/2;return{halfWidth:t,halfHeight:t}}let e=Math.abs(this.camera.position.y),t=u.M8C.degToRad(this.camera.fov),i=Math.tan(t/2)*e,s=i*this.camera.aspect,a=this.config.planeSize||20,r=a/2;return{halfWidth:Math.min(s,r),halfHeight:Math.min(i,r)}}updateGridOverlay(){var e,t;if(!this.scene)return;this.gridOverlay&&(this.scene.remove(this.gridOverlay),this.gridOverlay.geometry.dispose(),this.gridOverlay.material.dispose(),this.gridOverlay=null),this.rowAxisOverlay&&(this.scene.remove(this.rowAxisOverlay),this.rowAxisOverlay.geometry.dispose(),this.rowAxisOverlay.material.dispose(),this.rowAxisOverlay=null);let i=null!==(e=this.config.surfaceMode)&&void 0!==e?e:0;if(0!==i)return;let s=this.config.layoutMode||0,a=(null!==(t=this.config.showGridOverlay)&&void 0!==t?t:1)>0;if(a){if(2===s){let{halfWidth:e,halfHeight:t}=this.getLayoutBounds(),i=.9*e,s=.9*t,a=[];for(let e=0;e<=8;e++){let t=e/8,r=(t-.5)*i*2,n=(t-.5)*s*2;a.push(r,.01,-s,r,.01,s),a.push(-i,.01,n,i,.01,n)}let r=new u.u9r;r.setAttribute("position",new u.a$l(a,3));let n=new u.nls({color:new u.Ilk(1,1,1),transparent:!0,opacity:.08});this.gridOverlay=new u.ejS(r,n),this.scene.add(this.gridOverlay);return}if(1===s){let{halfWidth:e}=this.getLayoutBounds(),t=.9*e,i=[-t,.01,0,t,.01,0],s=new u.u9r;s.setAttribute("position",new u.a$l(i,3));let a=new u.nls({color:new u.Ilk(1,1,1),transparent:!0,opacity:.12});this.rowAxisOverlay=new u.ejS(s,a),this.scene.add(this.rowAxisOverlay)}}}getGridCellIndex(e){if(64!==this.gridCellOrder.length){this.gridCellOrder=Array.from({length:64},(e,t)=>t);for(let e=this.gridCellOrder.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[this.gridCellOrder[e],this.gridCellOrder[t]]=[this.gridCellOrder[t],this.gridCellOrder[e]]}this.gridCursor=0}let t=this.config.layoutMode||0,i=this.config.maxRipples||128;if(!(2===t&&i>=32))return e%64;let s=this.gridCellOrder[this.gridCursor%64];return this.gridCursor++,s}getSurfacePosition(e){var t;let i=null!==(t=this.config.surfaceMode)&&void 0!==t?t:0;if(1===i){let e,t;let i=(Math.random()-.5)*6,s=(Math.random()-.5)*6;switch(Math.floor(6*Math.random())){case 0:e=new u.Pa4(3,i,s),t=new u.Pa4(1,0,0);break;case 1:e=new u.Pa4(-3,i,s),t=new u.Pa4(-1,0,0);break;case 2:e=new u.Pa4(i,3,s),t=new u.Pa4(0,1,0);break;case 3:e=new u.Pa4(i,-3,s),t=new u.Pa4(0,-1,0);break;case 4:e=new u.Pa4(i,s,3),t=new u.Pa4(0,0,1);break;default:e=new u.Pa4(i,s,-3),t=new u.Pa4(0,0,-1)}return{position:e,normal:t}}if(2===i){let e=Math.random()*Math.PI*2,t=Math.acos(2*Math.random()-1),i=new u.Pa4(4*Math.sin(t)*Math.cos(e),4*Math.sin(t)*Math.sin(e),4*Math.cos(t)),s=i.clone().normalize();return{position:i,normal:s}}return{position:new u.Pa4(0,0,0),normal:new u.Pa4(0,1,0)}}addRipple(e,t){var i;let s,a;if(this.ripples.length>=(this.config.maxRipples||128))return;let r=null!==(i=this.config.surfaceMode)&&void 0!==i?i:0,n=e/63;if(0===r){let t=this.config.layoutMode||0,{halfWidth:i,halfHeight:r}=this.getLayoutBounds(),o=.9*i,l=.9*r,h=0,c=0;switch(t){case 1:h=-o+n*o*2,c=0;break;case 2:{let t=this.getGridCellIndex(e);h=(t%8/7-.5)*o*2,c=(Math.floor(t/8)/7-.5)*l*2;break}case 3:{let e=n*Math.PI*8,t=n*Math.min(o,l)*.85;h=Math.cos(e)*t,c=Math.sin(e)*t;break}default:h=(Math.random()-.5)*o*2,c=(Math.random()-.5)*l*2}s=new u.Pa4(h,0,c),a=new u.Pa4(0,1,0)}else{let t=this.getSurfacePosition(e);s=t.position,a=t.normal}let o=new u.Ilk().setHSL(.7*n,.8+.2*n,.5+.3*t),l={position:s,surfaceNormal:a,startTime:performance.now(),amplitude:t*(this.config.intensity||1.5),maxRadius:(8-6*n)*(0===r?1:.3),speed:1.5+2*n,frequencyBand:e,color:o};this.ripples.push(l),this.createRippleMesh(l)}createRippleMesh(e){var t;if(!this.scene)return;let i=new u.o8S(.01,.02,64),s=new u.vBJ({color:e.color,transparent:!0,opacity:e.amplitude,side:u.ehD}),a=new u.Kj0(i,s),r=null!==(t=this.config.surfaceMode)&&void 0!==t?t:0;if(0===r)a.position.set(e.position.x,0,e.position.z),a.rotation.x=-Math.PI/2;else{let t=e.surfaceNormal.clone().multiplyScalar(.02);a.position.copy(e.position).add(t);let i=e.position.clone().add(e.surfaceNormal);a.lookAt(i)}a.userData.ripple=e,this.scene.add(a),this.rippleMeshes.push(a)}init(){this.initScene()}update(e){var t,i,s;if(!this.scene)return;let a=(e.bassAvg+e.midAvg+e.highAvg)/3,r=a<.02||!e.isPlaying;if(r?this.isPaused||(this.isPaused=!0,this.pauseStartTime=performance.now()):this.isPaused&&(this.isPaused=!1,this.pauseStartTime=0),!this.isPaused){let i=performance.now(),s=(null!==(t=this.config.bassThreshold)&&void 0!==t?t:.1)*255,a=this.config.layoutMode||0;for(let t=0;t<e.audioData.length;t++){let r=e.audioData[t],n=t/63,o=.5+.5*n,l=s*o;1===a&&(l*=1+.35*(.5-n));let h=280-240*n;if(1===a&&(h=260-200*n),r>l&&i-this.lastDropTimes[t]>h){let e=1+(1-n)*.5,s=Math.min(r/255*e,1);this.addRipple(t,s),this.lastDropTimes[t]=i}}}let n=performance.now(),o=this.config.ringThickness||.3;for(let e=this.rippleMeshes.length-1;e>=0;e--){let t=this.rippleMeshes[e],i=t.userData.ripple;if(!i)continue;let s=(n-i.startTime)/1e3,a=s*i.speed,r=a/i.maxRadius;if(r>=1){this.scene.remove(t),t.geometry.dispose(),t.material.dispose(),this.rippleMeshes.splice(e,1);let s=this.ripples.indexOf(i);s>-1&&this.ripples.splice(s,1);continue}let l=Math.max(.01,a-o/2),h=a+o/2,c=i.amplitude;if(r>.6&&(c*=1-(r-.6)/.4),this.isPaused&&this.pauseStartTime>0){let e=(n-this.pauseStartTime)/1e3,t=Math.max(0,1-e/2);c*=t}t.geometry.dispose(),t.geometry=new u.o8S(l,h,64),t.material.opacity=c}let l=null!==(i=this.config.surfaceMode)&&void 0!==i?i:0;if(l>0&&!this.isDragging){let e=null!==(s=this.config.autoRotation)&&void 0!==s?s:.003;this.cameraRotation.y+=e}this.updateCameraPosition()}render(){this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)}clearAllRipples(){if(this.scene){for(let e of this.rippleMeshes)this.scene.remove(e),e.geometry.dispose(),e.material.dispose();this.rippleMeshes=[],this.ripples=[]}}destroy(){this.stopAnimationLoop(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.boundOnMouseDown&&(this.container.removeEventListener("mousedown",this.boundOnMouseDown),this.boundOnMouseDown=null),this.boundOnMouseMove&&(window.removeEventListener("mousemove",this.boundOnMouseMove),this.boundOnMouseMove=null),this.boundOnMouseUp&&(window.removeEventListener("mouseup",this.boundOnMouseUp),this.boundOnMouseUp=null),this.gridOverlay&&this.scene&&(this.scene.remove(this.gridOverlay),this.gridOverlay.geometry.dispose(),this.gridOverlay.material.dispose(),this.gridOverlay=null),this.rowAxisOverlay&&this.scene&&(this.scene.remove(this.rowAxisOverlay),this.rowAxisOverlay.geometry.dispose(),this.rowAxisOverlay.material.dispose(),this.rowAxisOverlay=null),this.surfaceMesh&&this.scene&&(this.scene.remove(this.surfaceMesh),this.surfaceMesh.geometry.dispose(),this.surfaceMesh.material.dispose(),this.surfaceMesh=null),this.clearAllRipples(),this.renderer&&(this.renderer.dispose(),this.container.contains(this.renderer.domElement)&&this.container.removeChild(this.renderer.domElement)),this.scene=null,this.camera=null,this.renderer=null}updateConfig(e,t){this.config[e]=t,"layoutMode"===e&&(this.layoutMode=t,this.updateGridOverlay(),2!==t&&(this.gridCellOrder=[],this.gridCursor=0)),"showGridOverlay"===e&&this.updateGridOverlay(),"surfaceMode"===e&&(this.clearAllRipples(),this.updateSurfaceMesh(),this.updateGridOverlay(),this.cameraRotation={x:.3,y:0},this.updateCameraPosition())}constructor(e,t,i){super(e,t,i),this.scene=null,this.camera=null,this.renderer=null,this.ripples=[],this.rippleMeshes=[],this.lastDropTimes=Array(64).fill(0),this.isPaused=!1,this.pauseStartTime=0,this.layoutMode=0,this.resizeObserver=null,this.gridOverlay=null,this.rowAxisOverlay=null,this.gridCellOrder=[],this.gridCursor=0,this.cameraRotation={x:.3,y:0},this.isDragging=!1,this.lastMouse={x:0,y:0},this.surfaceMesh=null,this.boundOnMouseDown=null,this.boundOnMouseMove=null,this.boundOnMouseUp=null}};let VisualizerRegistry=class VisualizerRegistry{static register(e,t,i,s){this.visualizers.set(e,{type:e,name:t,constructor:i,defaultConfig:s})}static create(e,t,i,s){let a=this.visualizers.get(e);if(!a)return console.error('Visualizer type "'.concat(e,'" not found in registry')),null;let r={...a.defaultConfig,...i};return new a.constructor(t,r,s)}static getTypes(){return Array.from(this.visualizers.keys())}static getName(e){var t;return(null===(t=this.visualizers.get(e))||void 0===t?void 0:t.name)||e}static getDefaultConfig(e){var t;return{...(null===(t=this.visualizers.get(e))||void 0===t?void 0:t.defaultConfig)||{}}}};VisualizerRegistry.visualizers=new Map,VisualizerRegistry.register("bars","Bars",BarsVisualizer,{scale:.5,smoothness:1,width:4,mode:0,palette:0}),VisualizerRegistry.register("orb","Orb",OrbVisualizer,{freqMultiplier:3.6,noiseMultiplier:.55,timeSpeed:2,autoRotationSpeed:.003,radius:2,meshDetail:4,wireframe:1,shape:0,lightIntensity:2,lightSpeed:.5,ambient:.3}),VisualizerRegistry.register("web","Web",WebVisualizer,{bassPulse:.4,midExtension:.5,highShimmer:.1,rotationSpeed:.002}),VisualizerRegistry.register("terrain","Terrain",TerrainVisualizer,{amplitude:3.9,speed:17.5,decay:.95,cameraDistance:9.5,autoRotation:5e-4}),VisualizerRegistry.register("chrysalis","Chrysalis",ChrysalisVisualizer,{slices:56,waviness:.05,rotationSpeed:.003,pulseIntensity:.7,lineThickness:2}),VisualizerRegistry.register("sonicGalaxy","Sonic Galaxy",SonicGalaxyVisualizer,{particleCount:3e4,attractorCount:4,bassGravity:2,midSpin:2,maxSpeed:8,velocityDamping:.04,particleSize:1,cameraSpeed:.004,trail:0,beatSensitivity:1.2}),VisualizerRegistry.register("raindrops","Raindrops",RaindropsVisualizer,{maxRipples:64,bassThreshold:.1,drizzleRate:.05,planeSize:40,intensity:.8,ringThickness:.1,layoutMode:0});let VisualizerManager=class VisualizerManager{switchVisualizer(e,t,i){this.currentVisualizer&&(this.currentVisualizer.destroy(),this.currentVisualizer=null),this.container.innerHTML="",this.currentVisualizer=VisualizerRegistry.create(e,this.container,t,i),this.currentType=e,this.currentVisualizer&&(this.currentVisualizer.init(),this.currentVisualizer.isInitialized=!0,this.startAnimationLoop())}updateConfig(e,t){this.currentVisualizer&&this.currentVisualizer.updateConfig(e,t)}updateColors(e){this.currentVisualizer&&this.currentVisualizer.updateColors(e)}setPlaybackState(e){this.isPlaying=e}getCurrentControls(){var e;return(null===(e=this.currentVisualizer)||void 0===e?void 0:e.getControls())||[]}getCurrentName(){var e;return(null===(e=this.currentVisualizer)||void 0===e?void 0:e.getName())||""}startAnimationLoop(){this.stopAnimationLoop();let animate=()=>{if(this.animationFrameId=requestAnimationFrame(animate),this.currentVisualizer){let e=this.audioEngine.getAnalysis(this.isPlaying);this.currentVisualizer.update(e),this.currentVisualizer.render()}};animate()}stopAnimationLoop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stopAnimationLoop(),this.currentVisualizer&&(this.currentVisualizer.destroy(),this.currentVisualizer=null)}constructor(e,t){this.currentVisualizer=null,this.currentType=null,this.animationFrameId=null,this.isPlaying=!1,this.audioEngine=e,this.container=t}};function useVisualizer(e){let{audioRef:t,containerRef:i,visualizerType:s,colors:r,isPlaying:n,enabled:l}=e,h=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(0,a.useRef)(null),d=(0,a.useRef)(null),m=(0,a.useRef)(!1),[p,g]=(0,a.useState)([]),[f,v]=(0,a.useState)({});(0,a.useEffect)(()=>{if(!t.current||!l)return;let e=t.current;if(u.current||(u.current=new(window.AudioContext||window.webkitAudioContext)),!m.current){let t=u.current.createMediaElementSource(e);d.current=u.current.createAnalyser(),d.current.fftSize=2048,d.current.smoothingTimeConstant=.8,t.connect(d.current),d.current.connect(u.current.destination),h.current=new AudioEngine(u.current,d.current,64),m.current=!0}},[t,l]),(0,a.useEffect)(()=>{if(i.current&&h.current&&l)return c.current=new VisualizerManager(h.current,i.current),()=>{var e;null===(e=c.current)||void 0===e||e.destroy(),c.current=null}},[i,l]),(0,a.useEffect)(()=>{if(!c.current||!l)return;let e={...VisualizerRegistry.getDefaultConfig(s),...f};c.current.switchVisualizer(s,e,r);let t=c.current.getCurrentControls();g(t)},[s,l]),(0,a.useEffect)(()=>{c.current&&l&&c.current.updateColors(r)},[r,l]),(0,a.useEffect)(()=>{c.current&&l&&c.current.setPlaybackState(n)},[n,l]),(0,a.useEffect)(()=>{var e;n&&(null===(e=u.current)||void 0===e?void 0:e.state)==="suspended"&&u.current.resume()},[n]);let y=(0,a.useCallback)((e,t)=>{c.current&&(c.current.updateConfig(e,t),v(i=>({...i,[e]:t})),g(i=>i.map(i=>i.key===e?{...i,value:t}:i)))},[]),x=(0,a.useCallback)(()=>{let e=VisualizerRegistry.getDefaultConfig(s);v(e),Object.entries(e).forEach(e=>{let[t,i]=e;c.current&&c.current.updateConfig(t,i)}),c.current&&g(c.current.getCurrentControls())},[s]),w=(0,a.useCallback)(()=>{let e=o[Math.floor(Math.random()*o.length)],t=VisualizerRegistry.getDefaultConfig(e),i={};return Object.entries(t).forEach(e=>{let[t,s]=e,a=s+(Math.random()-.5)*2*(.8*Math.abs(s));a=Math.max(0,a),Number.isInteger(s)&&0!==s&&(a=Math.max(1,Math.round(a))),i[t]=a}),v(i),e},[]);return{controls:p,currentConfig:f,updateConfig:y,resetToDefaults:x,randomize:w,visualizerName:VisualizerRegistry.getName(s),audioContextRef:u}}let f={dominant:"rgb(115, 115, 115)",accent:"rgb(163, 163, 163)"};function extractColors(e){return new Promise(t=>{let i=new Image;i.crossOrigin="Anonymous",i.src=e,i.onload=()=>{try{let e=document.createElement("canvas"),s=e.getContext("2d");if(!s){t(f);return}e.width=i.width,e.height=i.height,s.drawImage(i,0,0);let a=s.getImageData(0,0,e.width,e.height),r=a.data,n=0,o=0,l=0,h=0,c=0,u=0,d=0,m=0;for(let e=0;e<r.length;e+=4){let t=(r[e]+r[e+1]+r[e+2])/3;t>40&&t<180&&(n+=r[e],o+=r[e+1],l+=r[e+2],h++),t>100&&t<220&&(c+=r[e],u+=r[e+1],d+=r[e+2],m++)}let p=h>0?"rgb(".concat(Math.floor(n/h),", ").concat(Math.floor(o/h),", ").concat(Math.floor(l/h),")"):f.dominant,g=m>0?"rgb(".concat(Math.floor(c/m),", ").concat(Math.floor(u/m),", ").concat(Math.floor(d/m),")"):f.accent;t({dominant:p,accent:g})}catch(e){console.log("Color extraction failed:",e),t(f)}},i.onerror=()=>t(f)})}function trackEvent(e,t){window.clarity&&(t?window.clarity("event",e,t):window.clarity("event",e))}function VisualizerControls(e){let{controls:t,onUpdateConfig:i,onReset:a,visualizerName:r}=e,n=c(e=>e.dominantColor);return(0,s.jsxs)("div",{className:"absolute top-20 right-4 w-72 max-h-[70vh] overflow-y-auto p-4 rounded-lg backdrop-blur-xl bg-black/60 border border-white/10 z-20 space-y-3",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white/90 mb-3 flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),r," Controls"]}),t.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex justify-between text-xs text-white/70 mb-1",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("span",{className:"font-mono",children:e.step>=1?e.value.toLocaleString():e.step>=.1?e.value.toFixed(1):e.step>=.01?e.value.toFixed(2):e.value.toFixed(4)})]}),(0,s.jsx)("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.value,onChange:t=>i(e.key,parseFloat(t.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer bg-white/10",style:{accentColor:n}})]},e.key)),(0,s.jsx)("button",{onClick:a,className:"w-full mt-2 px-3 py-2 rounded bg-white/10 text-white/70 hover:bg-white/20 transition-all duration-300 text-xs font-medium",children:"Reset to Defaults"})]})}function VisualizerContainer(e){let{containerRef:t}=e,i=c(e=>e.currentMix),a=c(e=>e.showVisualizer),r=c(e=>e.accentColor);return i?a?(0,s.jsx)("div",{ref:t,className:"w-full h-full cursor-grab active:cursor-grabbing",style:{touchAction:"none"}}):(0,s.jsx)("img",{src:i.cover,alt:i.title,className:"w-[80vw] max-w-md aspect-square object-cover rounded shadow-xl",style:{boxShadow:"0 0 0 3px ".concat(r,"40")}}):null}function TrackMenu(e){let{mix:t,position:i="below"}=e,[r,n]=(0,a.useState)(!1),[o,l]=(0,a.useState)(!1),h=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!r)return;let handleClick=e=>{h.current&&!h.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",handleClick),()=>document.removeEventListener("mousedown",handleClick)},[r]);let c="https://parttimechiller.com/ptc-player/track/".concat(t.slug),u=(0,a.useCallback)(async()=>{if(navigator.share)try{await navigator.share({title:"".concat(t.title,"  Part Time Chiller"),text:t.description,url:c})}catch(e){}else await navigator.clipboard.writeText(c),l(!0),setTimeout(()=>l(!1),2e3);n(!1)},[t,c]),d=(0,a.useCallback)(()=>{window.open(t.audio,"_blank"),n(!1)},[t.audio]);return(0,s.jsxs)("div",{className:"relative",ref:h,children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),n(!r)},className:"w-8 h-8 rounded-full flex items-center justify-center text-white/50 hover:text-white hover:bg-white/10 transition-all flex-shrink-0","aria-label":"More options",children:(0,s.jsxs)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{cx:"12",cy:"5",r:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"19",r:"2"})]})}),r&&(0,s.jsxs)("div",{className:"absolute right-0 z-50 w-40 rounded-lg backdrop-blur-xl bg-black/80 border border-white/15 shadow-xl overflow-hidden ".concat("above"===i?"bottom-full mb-2":"top-full mt-2"),onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("button",{onClick:u,className:"w-full px-3 py-2.5 text-left text-sm text-white/90 hover:bg-white/10 transition-colors flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),o?"Link copied!":"Share"]}),(0,s.jsxs)("button",{onClick:d,className:"w-full px-3 py-2.5 text-left text-sm text-white/90 hover:bg-white/10 transition-colors flex items-center gap-2 border-t border-white/10",children:[(0,s.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})]})}function formatTime(e){let t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?"".concat(t,":").concat(i.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0")):"".concat(i,":").concat(s.toString().padStart(2,"0"))}function DetailView(e){let{audioRef:t,containerRef:i,onTogglePlay:r,onPlayNext:n,onPlayPrevious:u,visualizerControls:d,onUpdateConfig:m,onResetConfig:p,onRandomize:g,visualizerName:f}=e,v=c(e=>e.currentMix),y=c(e=>e.isPlaying),x=c(e=>e.progress),w=c(e=>e.currentTime),M=c(e=>e.duration),b=c(e=>e.dominantColor),C=c(e=>e.accentColor),k=c(e=>e.showVisualizer),z=c(e=>e.setShowVisualizer),P=c(e=>e.showControls),S=c(e=>e.setShowControls),j=c(e=>e.visualizerType),R=c(e=>e.setVisualizerType),A=c(e=>e.getCurrentIndex),D=c(e=>e.getFilteredMixes),T=c(e=>e.setProgress),I=c(e=>e.setCurrentTime),E=c(e=>e.shuffleMode),L=c(e=>e.toggleShuffle),N=c(e=>e.repeatMode),B=c(e=>e.cycleRepeat),V=c(e=>e.showPlaylist),O=c(e=>e.setShowPlaylist),F=c(e=>e.setCurrentMix),G=c(e=>e.setDominantColor),H=c(e=>e.setAccentColor),_=c(e=>e.setDuration),q=c(e=>e.volume),U=c(e=>e.setVolume),W=c(e=>e.isMuted),X=c(e=>e.toggleMute),Y=c(e=>e.showDebug),K=c(e=>e.currentFont),Z=c(e=>e.setCurrentFont),$=c(e=>e.filter),J=c(e=>e.setFilter),Q=A(),ee=D(),et=k?l[j]:"Album Art",[ei,es]=(0,a.useState)(!1),ea=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!ei)return;let handleClick=e=>{ea.current&&!ea.current.contains(e.target)&&es(!1)};return document.addEventListener("mousedown",handleClick),()=>document.removeEventListener("mousedown",handleClick)},[ei]);let er=(0,a.useCallback)(e=>{let i=t.current;if(!i)return;let s=e.currentTarget.getBoundingClientRect(),a=e.clientX-s.left,r=a/s.width*100,n=r/100*i.duration;i.currentTime=n,T(r),I(n),trackEvent("progress_scrubbed",null==v?void 0:v.title)},[t,v,T,I]),en=(0,a.useCallback)(e=>{let t=o.length+1,i=k?o.indexOf(j)+1:0,s=(i+e+t)%t;0===s?z(!1):(z(!0),R(o[s-1]))},[k,j,z,R]),eo=(0,a.useCallback)(async e=>{F(e),T(0),I(0),_(0),O(!1);let t=await extractColors(e.cover);G(t.dominant),H(t.accent),trackEvent("song_selected",e.title)},[F,T,I,_,O,G,H]);return v?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col",children:[(0,s.jsx)("div",{className:"absolute inset-0 transition-opacity duration-1000",style:{backgroundImage:"url(".concat(v.cover,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:(0,s.jsx)("div",{className:"absolute inset-0 bg-black/85 backdrop-blur-3xl"})}),(0,s.jsxs)("div",{className:"relative z-10 flex items-center justify-between px-4 py-3 border-b border-neutral-800/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>O(!V),children:[(0,s.jsx)("img",{src:"https://media.parttimechiller.com/logo3.png",alt:"PTC",className:"h-10 w-10"}),(0,s.jsx)("span",{className:"text-lg font-bold hidden sm:inline",children:"Part Time Chiller"}),Y&&(0,s.jsx)("select",{value:K,onChange:e=>Z(e.target.value),className:"ml-2 px-2 py-1 text-xs rounded border border-neutral-700 bg-black/50 backdrop-blur hover:border-white transition-colors cursor-pointer focus:outline-none focus:border-white",title:"Select Font (Debug Mode)",children:h.map(e=>(0,s.jsx)("option",{value:e,style:{fontFamily:e},children:e},e))})]}),(0,s.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[(0,s.jsx)("a",{href:"https://instagram.com/parttimechiller",target:"_blank",rel:"noopener noreferrer",className:"w-9 h-9 rounded-full flex items-center justify-center transition-all bg-neutral-800 hover:bg-gradient-to-br hover:from-purple-600 hover:to-pink-500 hover:scale-110",title:"Instagram",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),(0,s.jsx)("a",{href:"https://youtube.com/@parttimechiller",target:"_blank",rel:"noopener noreferrer",className:"w-9 h-9 rounded-full flex items-center justify-center transition-all bg-neutral-800 hover:bg-red-600 hover:scale-110",title:"YouTube",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})}),(0,s.jsx)("a",{href:"https://open.spotify.com/user/ameet3000?si=833fb8c8623241a1",target:"_blank",rel:"noopener noreferrer",className:"w-9 h-9 rounded-full flex items-center justify-center transition-all bg-neutral-800 hover:bg-green-500 hover:scale-110",title:"Spotify",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})})})]}),(0,s.jsxs)("div",{className:"relative sm:hidden order-last",ref:ea,children:[(0,s.jsx)("button",{onClick:()=>es(!ei),className:"w-8 h-8 rounded-full flex items-center justify-center transition-all bg-neutral-800 hover:bg-neutral-700","aria-label":"Social links",children:(0,s.jsxs)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{cx:"5",cy:"12",r:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"2"}),(0,s.jsx)("circle",{cx:"19",cy:"12",r:"2"})]})}),ei&&(0,s.jsxs)("div",{className:"absolute right-0 top-full mt-2 z-50 w-44 rounded-lg backdrop-blur-xl bg-black/80 border border-white/15 shadow-xl overflow-hidden",children:[(0,s.jsxs)("a",{href:"https://instagram.com/parttimechiller",target:"_blank",rel:"noopener noreferrer",className:"w-full px-3 py-2.5 text-left text-sm text-white/90 hover:bg-white/10 transition-colors flex items-center gap-3",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})}),"Instagram"]}),(0,s.jsxs)("a",{href:"https://youtube.com/@parttimechiller",target:"_blank",rel:"noopener noreferrer",className:"w-full px-3 py-2.5 text-left text-sm text-white/90 hover:bg-white/10 transition-colors flex items-center gap-3 border-t border-white/10",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),"YouTube"]}),(0,s.jsxs)("a",{href:"https://open.spotify.com/user/ameet3000?si=833fb8c8623241a1",target:"_blank",rel:"noopener noreferrer",className:"w-full px-3 py-2.5 text-left text-sm text-white/90 hover:bg-white/10 transition-colors flex items-center gap-3 border-t border-white/10",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),"Spotify"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 sm:flex-none justify-center sm:justify-end",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:()=>en(-1),className:"px-2 py-1 rounded-l bg-neutral-800 hover:bg-neutral-700 text-white text-sm transition-colors","aria-label":"Previous view",children:(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),(0,s.jsx)("span",{className:"px-3 py-1 bg-neutral-800/80 text-white text-sm select-none min-w-[5rem] text-center whitespace-nowrap",children:et}),(0,s.jsx)("button",{onClick:()=>en(1),className:"px-2 py-1 rounded-r bg-neutral-800 hover:bg-neutral-700 text-white text-sm transition-colors","aria-label":"Next view",children:(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),(0,s.jsx)("button",{onClick:g,className:"px-3 py-1 rounded bg-neutral-800 hover:bg-neutral-700 text-white text-sm transition-colors",title:"Randomize Visualizer",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),(0,s.jsx)("button",{onClick:()=>k&&S(!P),disabled:!k,className:"px-3 py-1 rounded text-sm transition-colors ".concat(k?"bg-neutral-800 hover:bg-neutral-700 text-white":"bg-neutral-800/50 text-neutral-600 cursor-not-allowed"),title:k?P?"Hide Controls":"Show Controls":"Controls unavailable for Album Art",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})})})]})]}),P&&k&&(0,s.jsx)(VisualizerControls,{controls:d,onUpdateConfig:m,onReset:p,visualizerName:f}),k&&(0,s.jsx)("div",{className:"absolute inset-0 z-[5] p-4",children:(0,s.jsx)(VisualizerContainer,{containerRef:i})}),(0,s.jsx)("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-center p-4 gap-6".concat(k?" pointer-events-none":""),children:!k&&(0,s.jsx)(VisualizerContainer,{containerRef:i})}),(0,s.jsxs)("div",{className:"absolute bottom-[72px] left-4 right-4 z-20 rounded-lg backdrop-blur-xl bg-black/60 border border-white/10 max-h-[60vh] overflow-y-auto transition-all duration-300 ".concat(V?"translate-y-0 opacity-100":"translate-y-4 opacity-0 pointer-events-none"),children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 p-3 pb-2 backdrop-blur-xl bg-black/80 border-b border-white/10 flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-sm text-neutral-300",children:[ee.length," tracks"]}),(0,s.jsx)("div",{className:"flex gap-1",children:["all","track","mix"].map(e=>(0,s.jsx)("button",{onClick:()=>J(e),className:"px-2 py-0.5 text-xs rounded ".concat($===e?"bg-white/20 text-white":"text-white/50 hover:text-white/70"),children:"all"===e?"All":"track"===e?"Tracks":"Mixes"},e))})]}),(0,s.jsx)("div",{className:"p-3 space-y-1",children:ee.map((e,t)=>(0,s.jsxs)("div",{onClick:()=>eo(e),className:"flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-all hover:bg-white/10 active:scale-[0.99] ".concat((null==v?void 0:v.title)===e.title?"bg-white/10 border border-white/20":"border border-transparent"),children:[(0,s.jsx)("img",{src:e.cover,alt:e.title,className:"w-10 h-10 rounded object-cover flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium truncate",children:e.title}),(0,s.jsxs)("div",{className:"text-xs text-neutral-400 truncate",children:[e.description,"  ",e.duration]})]}),(0,s.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded border flex-shrink-0 ".concat("mix"===e.type?"border-purple-500/40 text-purple-400/90":"border-blue-500/40 text-blue-400/90"),children:e.type}),(0,s.jsx)(TrackMenu,{mix:e,position:"below"})]},t))})]}),(0,s.jsxs)("div",{className:"relative z-10 px-3 sm:px-4 py-3 flex items-center gap-2 sm:gap-4 backdrop-blur-xl border-t border-neutral-800/50",style:{background:"linear-gradient(to right, ".concat(b,"25, ").concat(C,"25)")},children:[(0,s.jsx)("button",{className:"p-0 m-0 border-none bg-transparent flex-shrink-0",onClick:()=>O(!V),"aria-label":V?"Hide playlist":"Show playlist",children:(0,s.jsx)("img",{src:v.cover,alt:v.title,className:"w-10 h-10 sm:w-12 sm:h-12 rounded object-cover shadow-lg transition-all duration-500",style:{boxShadow:"0 0 0 2px ".concat(C,"40")}})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-xs sm:text-sm font-medium truncate",children:v.title}),(0,s.jsx)("div",{className:"w-full h-1.5 bg-black/30 rounded-full overflow-hidden mt-1 cursor-pointer relative backdrop-blur",onClick:er,children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 shadow-lg",style:{width:"".concat(x,"%"),background:"linear-gradient(to right, ".concat(b,", ").concat(C,")")}})}),(0,s.jsx)("div",{className:"flex justify-between items-center mt-0.5",children:(0,s.jsxs)("span",{className:"text-[10px] sm:text-xs text-neutral-300",children:[formatTime(w)," / ",formatTime(M)]})})]}),(0,s.jsx)("button",{onClick:L,className:"w-8 h-8 rounded-full flex-shrink-0 hidden sm:flex items-center justify-center transition-all ".concat(E?"text-white":"text-white/40 hover:text-white/70"),style:E?{color:C}:void 0,"aria-label":"Toggle shuffle",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"})})}),(0,s.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[(0,s.jsx)("button",{onClick:u,className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-white shadow-lg transition-all duration-300 hover:scale-105 active:scale-95",style:{background:"linear-gradient(135deg, ".concat(b,", ").concat(C,")")},disabled:0===Q&&"off"===N,"aria-label":"Previous track",children:(0,s.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})})}),(0,s.jsx)("button",{onClick:r,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center text-white shadow-lg transition-all duration-300 hover:scale-105 active:scale-95",style:{background:"linear-gradient(135deg, ".concat(b,", ").concat(C,")")},children:y?(0,s.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):(0,s.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,s.jsx)("button",{onClick:n,className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-white shadow-lg transition-all duration-300 hover:scale-105 active:scale-95",style:{background:"linear-gradient(135deg, ".concat(b,", ").concat(C,")")},disabled:Q===ee.length-1&&"off"===N,"aria-label":"Next track",children:(0,s.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})})})]}),(0,s.jsxs)("button",{onClick:B,className:"w-8 h-8 rounded-full flex-shrink-0 hidden sm:flex items-center justify-center transition-all relative ".concat("off"!==N?"text-white":"text-white/40 hover:text-white/70"),style:"off"!==N?{color:C}:void 0,"aria-label":"Repeat: ".concat(N),children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"one"===N&&(0,s.jsx)("span",{className:"absolute -top-0.5 -right-0.5 text-[8px] font-bold",style:{color:C},children:"1"})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-1 flex-shrink-0",children:[(0,s.jsx)("button",{onClick:X,className:"w-8 h-8 rounded-full flex items-center justify-center text-white/60 hover:text-white transition-all","aria-label":W?"Unmute":"Mute",children:W||0===q?(0,s.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51A8.796 8.796 0 0021 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06a8.99 8.99 0 003.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}):q<.5?(0,s.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"})}):(0,s.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})})}),(0,s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:W?0:q,onChange:e=>{let t=parseFloat(e.target.value);U(t),W&&t>0&&X()},className:"w-16 lg:w-20 h-1.5 rounded-lg appearance-none cursor-pointer bg-white/10",style:{accentColor:b},"aria-label":"Volume"})]}),(0,s.jsx)(TrackMenu,{mix:v,position:"above"})]})]}):null}function PlayerApp(e){let{initialSlug:t}=e,i=(0,a.useRef)(null),r=(0,a.useRef)(null),o=c(e=>e.currentMix),l=c(e=>e.isPlaying),h=c(e=>e.setIsPlaying),u=c(e=>e.setProgress),d=c(e=>e.setCurrentTime),m=c(e=>e.setDuration),p=c(e=>e.volume),g=c(e=>e.isMuted),f=c(e=>e.dominantColor),v=c(e=>e.accentColor),y=c(e=>e.setDominantColor),x=c(e=>e.setAccentColor),w=c(e=>e.setCurrentMix),M=c(e=>e.setShowDetail),b=c(e=>e.setShowVisualizer),C=c(e=>e.showVisualizer),k=c(e=>e.visualizerType),z=c(e=>e.setVisualizerType),P=c(e=>e.currentFont),S=c(e=>e.setShowDebug),{controls:j,updateConfig:R,resetToDefaults:A,randomize:D,visualizerName:T,audioContextRef:I}=useVisualizer({audioRef:i,containerRef:r,visualizerType:k,colors:{dominant:f,accent:v},isPlaying:l,enabled:C&&!!o});(0,a.useEffect)(()=>{i.current&&(i.current.volume=g?0:p)},[p,g]);let E=(0,a.useCallback)(async e=>{if(!e)return;w(e),u(0),d(0),m(0),M(!0),b(!0),e.slug&&window.history.replaceState({},"","/ptc-player/track/".concat(e.slug));let t=await extractColors(e.cover);y(t.dominant),x(t.accent),trackEvent("song_selected",e.title)},[w,u,d,m,M,b,y,x]);(0,a.useEffect)(()=>{let e=i.current;if(!e||!o)return;let onTimeUpdate=()=>{e.duration&&(u(e.currentTime/e.duration*100),d(e.currentTime))},onLoadedMetadata=()=>m(e.duration),onDurationChange=()=>m(e.duration),onEnded=()=>{trackEvent("song_completed",o.title);let e=c.getState().playNext();e?E(e):h(!1)},onError=()=>console.log("Audio error");return e.addEventListener("timeupdate",onTimeUpdate),e.addEventListener("loadedmetadata",onLoadedMetadata),e.addEventListener("durationchange",onDurationChange),e.addEventListener("ended",onEnded),e.addEventListener("error",onError),()=>{e.removeEventListener("timeupdate",onTimeUpdate),e.removeEventListener("loadedmetadata",onLoadedMetadata),e.removeEventListener("durationchange",onDurationChange),e.removeEventListener("ended",onEnded),e.removeEventListener("error",onError)}},[o,E,u,d,m,h]),(0,a.useEffect)(()=>{if(!o||!i.current)return;let e=setTimeout(async()=>{try{var e;(null===(e=I.current)||void 0===e?void 0:e.state)==="suspended"&&await I.current.resume(),i.current.load(),await i.current.play(),h(!0),trackEvent("song_played",o.title)}catch(e){console.log("Auto-play failed:",e)}},100);return()=>clearTimeout(e)},[o]),(0,a.useEffect)(()=>{let e=P.replace(/ /g,"+"),t=document.createElement("link");return t.href="https://fonts.googleapis.com/css2?family=".concat(e,":wght@400;700&display=swap"),t.rel="stylesheet",document.head.appendChild(t),()=>{document.head.removeChild(t)}},[P]),(0,a.useEffect)(()=>{if(o)return;let e=t?getMixBySlug(t):n[0];e&&(async()=>{w(e),M(!0),b(!0),e.slug&&window.history.replaceState({},"","/ptc-player/track/".concat(e.slug));let t=await extractColors(e.cover);y(t.dominant),x(t.accent)})()},[]),(0,a.useEffect)(()=>{let handleKeyDown=e=>{(e.metaKey||e.ctrlKey)&&"d"===e.key&&(e.preventDefault(),S(!c.getState().showDebug))};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[S]),(0,a.useEffect)(()=>{let handleKeyDown=e=>{if("ArrowUp"!==e.key||e.metaKey||e.ctrlKey){if("ArrowDown"!==e.key||e.metaKey||e.ctrlKey)" "===e.key&&e.target===document.body&&(e.preventDefault(),L());else{e.preventDefault();let t=c.getState();t.setVolume(Math.max(0,t.volume-.05))}}else{e.preventDefault();let t=c.getState();t.setVolume(Math.min(1,t.volume+.05))}};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[]);let L=(0,a.useCallback)(async()=>{var e,t,s;let a=i.current;if(!a)return;let r=c.getState();if(r.isPlaying)a.pause(),h(!1),trackEvent("song_paused",null===(e=r.currentMix)||void 0===e?void 0:e.title);else try{(null===(t=I.current)||void 0===t?void 0:t.state)==="suspended"&&await I.current.resume(),await a.play(),h(!0),trackEvent("song_played",null===(s=r.currentMix)||void 0===s?void 0:s.title)}catch(e){console.log("Play failed:",e)}},[h,I]),N=(0,a.useCallback)(()=>{let e=c.getState().playNext();e&&E(e)},[E]),B=(0,a.useCallback)(()=>{let e=c.getState().playPrevious();e&&("restart"===e.action?i.current&&(i.current.currentTime=0):E(e.mix))},[E]),V=(0,a.useCallback)(()=>{let e=D();z(e)},[D,z]);return(0,s.jsxs)("div",{className:"min-h-screen bg-black text-white relative",style:{fontFamily:P},children:[o&&(0,s.jsx)("audio",{ref:i,src:o.audio,preload:"metadata",crossOrigin:"anonymous"}),(0,s.jsx)(DetailView,{audioRef:i,containerRef:r,onTogglePlay:L,onPlayNext:N,onPlayPrevious:B,visualizerControls:j,onUpdateConfig:R,onResetConfig:A,onRandomize:V,visualizerName:T})]})}}}]);